package com.biz.sccba.sqlanalyzer.service;

import com.biz.sccba.sqlanalyzer.model.PromptTemplateDefinition;
import com.biz.sccba.sqlanalyzer.repository.PromptTemplateRepository;
import jakarta.annotation.PostConstruct;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
public class PromptTemplateManagerService {

    private static final Logger logger = LoggerFactory.getLogger(PromptTemplateManagerService.class);

    @Autowired
    private PromptTemplateRepository repository;

    public static final String TYPE_MYSQL = "MYSQL";
    public static final String TYPE_GOLDENDB = "GOLDENDB";
    public static final String TYPE_TABLE_QUERY_ANALYSIS = "TABLE_QUERY_ANALYSIS";
    public static final String TYPE_SQL_AGENT_DISTRIBUTION = "SQL_AGENT_DISTRIBUTION";
    public static final String TYPE_SQL_AGENT_PLAN_EVALUATION = "SQL_AGENT_PLAN_EVALUATION";
    public static final String TYPE_SQL_RISK_ASSESSMENT = "SQL_RISK_ASSESSMENT";
    public static final String TYPE_SQL_RISK_COMPARISON = "SQL_RISK_COMPARISON";
    public static final String TYPE_SQL_RISK_REFINEMENT = "SQL_RISK_REFINEMENT";
    public static final String TYPE_SQL_PARAMETER_FILLING = "SQL_PARAMETER_FILLING";
    public static final String TYPE_SQL_INDEX_OPTIMIZATION = "SQL_INDEX_OPTIMIZATION";

    @PostConstruct
    public void initDefaultTemplates() {
        logger.info("æ£€æŸ¥å¹¶åˆå§‹åŒ–é»˜è®¤ Prompt æ¨¡æ¿...");
        
        // æ£€æŸ¥å¹¶åˆå§‹åŒ– MySQL æ¨¡æ¿
        if (repository.findByTemplateType(TYPE_MYSQL).isEmpty()) {
            createDefaultTemplate(TYPE_MYSQL, "MySQLæ€§èƒ½åˆ†æä¸“å®¶", getDefaultMysqlTemplate());
        }
        
        // æ£€æŸ¥å¹¶åˆå§‹åŒ– GoldenDB æ¨¡æ¿
        if (repository.findByTemplateType(TYPE_GOLDENDB).isEmpty()) {
            createDefaultTemplate(TYPE_GOLDENDB, "GoldenDBæ€§èƒ½åˆ†æä¸“å®¶", getDefaultGoldenDbTemplate());
        }
        
        // æ£€æŸ¥å¹¶åˆå§‹åŒ–è¡¨æŸ¥è¯¢åˆ†ææ¨¡æ¿
        if (repository.findByTemplateType(TYPE_TABLE_QUERY_ANALYSIS).isEmpty()) {
            createDefaultTemplate(TYPE_TABLE_QUERY_ANALYSIS, "è¡¨æŸ¥è¯¢ç»¼åˆåˆ†æä¸“å®¶", getDefaultTableQueryAnalysisTemplate());
        }

        // æ£€æŸ¥å¹¶åˆå§‹åŒ– SQL Agent åˆ†å¸ƒåˆ†ææ¨¡æ¿
        if (repository.findByTemplateType(TYPE_SQL_AGENT_DISTRIBUTION).isEmpty()) {
            createDefaultTemplate(TYPE_SQL_AGENT_DISTRIBUTION, "SQL Agent æ•°æ®åˆ†å¸ƒåˆ†æä¸“å®¶", getDefaultSqlAgentDistributionTemplate());
        }

        // æ£€æŸ¥å¹¶åˆå§‹åŒ– SQL Agent æ‰§è¡Œè®¡åˆ’è¯„ä¼°æ¨¡æ¿
        if (repository.findByTemplateType(TYPE_SQL_AGENT_PLAN_EVALUATION).isEmpty()) {
            createDefaultTemplate(TYPE_SQL_AGENT_PLAN_EVALUATION, "SQL Agent æ‰§è¡Œè®¡åˆ’è¯„ä¼°ä¸“å®¶", getDefaultSqlAgentPlanEvaluationTemplate());
        }

        // æ£€æŸ¥å¹¶åˆå§‹åŒ– SQL é£é™©è¯„ä¼°æ¨¡æ¿
        if (repository.findByTemplateType(TYPE_SQL_RISK_ASSESSMENT).isEmpty()) {
            createDefaultTemplate(TYPE_SQL_RISK_ASSESSMENT, "SQL é£é™©è¯„ä¼° DBA ä¸“å®¶", getDefaultSqlRiskAssessmentTemplate());
        }

        // æ£€æŸ¥å¹¶åˆå§‹åŒ– SQL é£é™©å¯¹æ¯”æ¨¡æ¿
        if (repository.findByTemplateType(TYPE_SQL_RISK_COMPARISON).isEmpty()) {
            createDefaultTemplate(TYPE_SQL_RISK_COMPARISON, "SQL é£é™©å¯¹æ¯”åˆ†æä¸“å®¶", getDefaultSqlRiskComparisonTemplate());
        }

        // æ£€æŸ¥å¹¶åˆå§‹åŒ– SQL é£é™©ä¿®æ­£æ¨¡æ¿
        if (repository.findByTemplateType(TYPE_SQL_RISK_REFINEMENT).isEmpty()) {
            createDefaultTemplate(TYPE_SQL_RISK_REFINEMENT, "SQL é£é™©ä¿®æ­£ä¸“å®¶", getDefaultSqlRiskRefinementTemplate());
        }

        // æ£€æŸ¥å¹¶åˆå§‹åŒ– SQL å‚æ•°å¡«å……æ¨¡æ¿
        if (repository.findByTemplateType(TYPE_SQL_PARAMETER_FILLING).isEmpty()) {
            createDefaultTemplate(TYPE_SQL_PARAMETER_FILLING, "SQL å‚æ•°å¡«å……ä¸“å®¶", getDefaultSqlParameterFillingTemplate());
        }

        // æ£€æŸ¥å¹¶åˆå§‹åŒ– SQL ç´¢å¼•ä¼˜åŒ–ç»¼åˆåˆ†ææ¨¡æ¿
        if (repository.findByTemplateType(TYPE_SQL_INDEX_OPTIMIZATION).isEmpty()) {
            createDefaultTemplate(TYPE_SQL_INDEX_OPTIMIZATION, "SQL ç´¢å¼•ä¼˜åŒ–ç»¼åˆåˆ†æä¸“å®¶", getDefaultSqlIndexOptimizationTemplate());
        }
    }

    private void createDefaultTemplate(String type, String name, String content) {
        PromptTemplateDefinition def = new PromptTemplateDefinition();
        def.setTemplateType(type);
        def.setTemplateName(name);
        def.setTemplateContent(content);
        def.setDescription("ç³»ç»Ÿé»˜è®¤åˆå§‹åŒ–æ¨¡æ¿");
        repository.save(def);
    }

    public String getTemplateContent(String type) {
        return repository.findByTemplateType(type)
                .map(PromptTemplateDefinition::getTemplateContent)
                .orElseThrow(() -> new RuntimeException("æ‰¾ä¸åˆ°ç±»å‹ä¸º " + type + " çš„ Prompt æ¨¡æ¿"));
    }

    public List<PromptTemplateDefinition> getAllTemplates() {
        return repository.findAll();
    }
    
    public PromptTemplateDefinition getTemplateDefinition(String type) {
        return repository.findByTemplateType(type)
                .orElseThrow(() -> new RuntimeException("æ‰¾ä¸åˆ°ç±»å‹ä¸º " + type + " çš„ Prompt æ¨¡æ¿"));
    }

    @Transactional
    public PromptTemplateDefinition updateTemplate(String type, String content) {
        PromptTemplateDefinition def = repository.findByTemplateType(type)
                .orElseThrow(() -> new RuntimeException("æ‰¾ä¸åˆ°ç±»å‹ä¸º " + type + " çš„ Prompt æ¨¡æ¿"));
        def.setTemplateContent(content);
        return repository.save(def);
    }

    @Transactional
    public PromptTemplateDefinition createTemplate(String type, String name, String content, String description) {
        // æ£€æŸ¥æ¨¡æ¿ç±»å‹æ˜¯å¦å·²å­˜åœ¨
        if (repository.findByTemplateType(type).isPresent()) {
            throw new RuntimeException("æ¨¡æ¿ç±»å‹ " + type + " å·²å­˜åœ¨");
        }
        
        PromptTemplateDefinition def = new PromptTemplateDefinition();
        def.setTemplateType(type);
        def.setTemplateName(name);
        def.setTemplateContent(content);
        def.setDescription(description != null ? description : "");
        return repository.save(def);
    }

    private String getDefaultMysqlTemplate() {
        return """
            ä½ æ˜¯ä¸€ä½èµ„æ·±çš„MySQL InnoDBæ€§èƒ½ä¼˜åŒ–ä¸“å®¶ï¼Œæ‹¥æœ‰10å¹´ä»¥ä¸Šçš„æ•°æ®åº“è°ƒä¼˜ç»éªŒã€‚è¯·é’ˆå¯¹ä»¥ä¸‹SQLæŸ¥è¯¢è¿›è¡Œä¸“ä¸šçš„æ€§èƒ½åˆ†æï¼Œå¹¶æä¾›è¯¦ç»†ã€å¯æ‰§è¡Œçš„ä¼˜åŒ–å»ºè®®ã€‚
            
            ## SQLè¯­å¥
            {sql}
            
            ## æ‰§è¡Œè®¡åˆ’
            {execution_plan}
            
            ## è¡¨ç»“æ„ä¿¡æ¯
            {table_structures}
            
            ## åˆ†æè¦æ±‚
            
            è¯·ä»ä»¥ä¸‹ä¸“ä¸šè§’åº¦æ·±å…¥åˆ†æSQLæ€§èƒ½ï¼ˆé‡ç‚¹å…³æ³¨MySQL InnoDBå¼•æ“ç‰¹æ€§ï¼‰ï¼š
            
            1. **æ‰§è¡Œè®¡åˆ’æ·±åº¦åˆ†æ**
               
               1.1 è®¿é—®ç±»å‹ï¼ˆtypeåˆ—ï¼‰åˆ†æï¼š
               - è¯¦ç»†è§£è¯»è®¿é—®ç±»å‹ï¼ˆALLã€indexã€rangeã€refã€eq_refã€constã€systemï¼‰
               - è¯„ä¼°è®¿é—®æ•ˆç‡ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
               - åˆ†ææ˜¯å¦å¯ä»¥é€šè¿‡ç´¢å¼•ä¼˜åŒ–æå‡è®¿é—®ç±»å‹
               
               1.2 ç´¢å¼•ä½¿ç”¨æƒ…å†µï¼š
               - åˆ†æä½¿ç”¨çš„ç´¢å¼•ç±»å‹ï¼ˆä¸»é”®ç´¢å¼•ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å¤åˆç´¢å¼•ï¼‰
               - è¯„ä¼°key_lenå€¼ï¼Œåˆ¤æ–­ç´¢å¼•ä½¿ç”¨é•¿åº¦å’Œé€‰æ‹©æ€§
               - æ£€æŸ¥æ˜¯å¦å­˜åœ¨ç´¢å¼•æœªå……åˆ†åˆ©ç”¨çš„æƒ…å†µ
               - åˆ†ærefåˆ—ï¼Œè¯„ä¼°è¿æ¥æ¡ä»¶çš„åŒ¹é…æ•ˆç‡
               
               1.3 æ‰«ææ•ˆç‡åˆ†æï¼š
               - åˆ†ærowsåˆ—ï¼ˆé¢„ä¼°æ‰«æè¡Œæ•°ï¼‰ä¸å®é™…æ•°æ®é‡çš„å…³ç³»
               - ç»“åˆfilteredåˆ—è¯„ä¼°è¿‡æ»¤æ•ˆç‡ï¼ˆfiltered < 100%è¡¨ç¤ºéœ€è¦é¢å¤–è¿‡æ»¤ï¼‰
               - è®¡ç®—å®é™…éœ€è¦å¤„ç†çš„è¡Œæ•°ï¼ˆrows Ã— filtered%ï¼‰
               - è¯†åˆ«æ˜¯å¦å­˜åœ¨å¤§é‡æ— æ•ˆæ‰«æ
               
               1.4 è¿æ¥ç®—æ³•åˆ†æï¼š
               - è¯†åˆ«ä½¿ç”¨çš„è¿æ¥ç®—æ³•ï¼ˆNested Loop Joinã€Block Nested Loopã€Batched Key Accessï¼‰
               - è¯„ä¼°è¿æ¥é¡ºåºæ˜¯å¦æœ€ä¼˜
               - åˆ†ææ˜¯å¦å­˜åœ¨ç¬›å¡å°”ç§¯é£é™©
               
               1.5 Extraåˆ—å…³é”®ä¿¡æ¯ï¼š
               - Using indexï¼šæ˜¯å¦ä½¿ç”¨äº†è¦†ç›–ç´¢å¼•
               - Using whereï¼šWHEREæ¡ä»¶è¿‡æ»¤æƒ…å†µ
               - Using filesortï¼šæ–‡ä»¶æ’åºé—®é¢˜
               - Using temporaryï¼šä¸´æ—¶è¡¨ä½¿ç”¨æƒ…å†µ
               - Using join bufferï¼šè¿æ¥ç¼“å†²åŒºä½¿ç”¨
               - Impossible WHEREï¼šä¸å¯èƒ½çš„WHEREæ¡ä»¶
            
            2. **InnoDBå¼•æ“ç‰¹æ€§åˆ†æ**
               
               2.1 ç´¢å¼•ç»“æ„åˆ†æï¼š
               - è¯„ä¼°èšç°‡ç´¢å¼•ï¼ˆä¸»é”®ç´¢å¼•ï¼‰çš„ä½¿ç”¨æƒ…å†µ
               - åˆ†æäºŒçº§ç´¢å¼•çš„é€‰æ‹©å’Œè®¾è®¡åˆç†æ€§
               - è¯„ä¼°è¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰çš„å¯èƒ½æ€§
               - æ£€æŸ¥æ˜¯å¦å­˜åœ¨å›è¡¨æŸ¥è¯¢ï¼ˆéœ€è¦è®¿é—®ä¸»é”®ç´¢å¼•ï¼‰
               
               2.2 InnoDBä¼˜åŒ–å™¨ç‰¹æ€§ï¼š
               - ç´¢å¼•ä¸‹æ¨ï¼ˆICP - Index Condition Pushdownï¼‰æ˜¯å¦ç”Ÿæ•ˆ
               - å¤šèŒƒå›´è¯»å–ï¼ˆMRR - Multi-Range Readï¼‰ä¼˜åŒ–è¯„ä¼°
               - æ‰¹é‡é”®è®¿é—®ï¼ˆBKA - Batched Key Accessï¼‰ä½¿ç”¨æƒ…å†µ
               
               2.3 é”æœºåˆ¶å½±å“ï¼š
               - è¯„ä¼°è¡Œé”ç«äº‰é£é™©
               - åˆ†æé—´éš™é”ï¼ˆGap Lockï¼‰çš„å½±å“èŒƒå›´
               - è¯„ä¼°æ­»é”å¯èƒ½æ€§
               - åˆ†æäº‹åŠ¡éš”ç¦»çº§åˆ«å¯¹æ€§èƒ½çš„å½±å“ï¼ˆMVCCå¼€é”€ï¼‰
               
               2.4 å­˜å‚¨å¼•æ“ç‰¹æ€§ï¼š
               - è¯„ä¼°ç¼“å†²æ± ï¼ˆBuffer Poolï¼‰å‘½ä¸­ç‡
               - åˆ†æé¡µåˆ†è£‚å’Œé¡µåˆå¹¶çš„å½±å“
               - è¯„ä¼°è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•ï¼ˆAHIï¼‰çš„é€‚ç”¨æ€§
            
            3. **æ€§èƒ½é—®é¢˜è¯†åˆ«**
               
               3.1 æ‰«æé—®é¢˜ï¼š
               - è¯†åˆ«å…¨è¡¨æ‰«æï¼ˆtype=ALLï¼‰åŠå…¶åŸå› 
               - è¯†åˆ«å…¨ç´¢å¼•æ‰«æï¼ˆtype=indexï¼‰åŠå…¶ä¼˜åŒ–ç©ºé—´
               - è¯„ä¼°æ‰«æè¡Œæ•°æ˜¯å¦åˆç†
               
               3.2 æ’åºå’Œåˆ†ç»„é—®é¢˜ï¼š
               - è¯†åˆ«æ–‡ä»¶æ’åºï¼ˆUsing filesortï¼‰åŠå…¶ä¼˜åŒ–æ–¹æ¡ˆ
               - åˆ†æä¸´æ—¶è¡¨ä½¿ç”¨ï¼ˆUsing temporaryï¼‰çš„åŸå› 
               - è¯„ä¼°GROUP BYå’ŒORDER BYçš„ä¼˜åŒ–ç©ºé—´
               
               3.3 ç´¢å¼•é—®é¢˜ï¼š
               - è¯†åˆ«ç´¢å¼•æœªä½¿ç”¨çš„æƒ…å†µåŠåŸå› 
               - è¯†åˆ«ç´¢å¼•é€‰æ‹©ä¸å½“çš„æƒ…å†µ
               - è¯†åˆ«ç´¢å¼•å†—ä½™æˆ–ç¼ºå¤±çš„æƒ…å†µ
               
               3.4 è¿æ¥é—®é¢˜ï¼š
               - è¯†åˆ«ä½æ•ˆçš„è¿æ¥æ–¹å¼
               - è¯†åˆ«è¿æ¥é¡ºåºä¸å½“çš„æƒ…å†µ
               - è¯†åˆ«å­æŸ¥è¯¢å¯ä¼˜åŒ–ä¸ºJOINçš„æƒ…å†µ
            
            4. **ä¼˜åŒ–å»ºè®®ï¼ˆå¿…é¡»æä¾›å…·ä½“å¯æ‰§è¡Œçš„æ–¹æ¡ˆï¼‰**
               
               4.1 ç´¢å¼•ä¼˜åŒ–å»ºè®®ï¼š
               - æä¾›å…·ä½“çš„ç´¢å¼•åˆ›å»ºè¯­å¥ï¼ˆCREATE INDEXï¼‰
               - è¯´æ˜ç´¢å¼•è®¾è®¡ç†ç”±ï¼ˆæœ€å·¦å‰ç¼€åŸåˆ™ã€é€‰æ‹©æ€§è€ƒè™‘ï¼‰
               - è¯„ä¼°ç´¢å¼•ç»´æŠ¤æˆæœ¬
               - å»ºè®®åˆ é™¤çš„å†—ä½™ç´¢å¼•
               - å¤åˆç´¢å¼•å­—æ®µé¡ºåºå»ºè®®
               
               4.2 SQLè¯­å¥é‡å†™å»ºè®®ï¼š
               - æä¾›ä¼˜åŒ–åçš„SQLè¯­å¥ï¼ˆå‰åå¯¹æ¯”ï¼‰
               - è¯´æ˜é‡å†™çš„ç†ç”±å’Œé¢„æœŸæ•ˆæœ
               - å­æŸ¥è¯¢ä¼˜åŒ–ä¸ºJOINçš„ç¤ºä¾‹
               - WHEREæ¡ä»¶ä¼˜åŒ–å»ºè®®
               - LIMITä¼˜åŒ–æŠ€å·§
               
               4.3 è¡¨ç»“æ„ä¼˜åŒ–å»ºè®®ï¼š
               - å­—æ®µç±»å‹ä¼˜åŒ–å»ºè®®ï¼ˆå‡å°‘å­˜å‚¨ç©ºé—´ï¼‰
               - è¡Œæ ¼å¼é€‰æ‹©å»ºè®®ï¼ˆCOMPACTã€DYNAMICã€COMPRESSEDï¼‰
               - åˆ†åŒºç­–ç•¥å»ºè®®ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
               - è¡¨å‹ç¼©å»ºè®®ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
               
               4.4 æŸ¥è¯¢é€»è¾‘ä¼˜åŒ–ï¼š
               - é¿å…SELECT *çš„å»ºè®®
               - åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–ï¼ˆé¿å…æ·±åº¦åˆ†é¡µï¼‰
               - æ‰¹é‡æ“ä½œä¼˜åŒ–å»ºè®®
               - æŸ¥è¯¢ç¼“å­˜åˆ©ç”¨å»ºè®®
               
               4.5 é…ç½®å‚æ•°è°ƒä¼˜å»ºè®®ï¼š
               - ç›¸å…³InnoDBå‚æ•°è°ƒä¼˜å»ºè®®
               - æŸ¥è¯¢ç¼“å­˜é…ç½®å»ºè®®
               - è¿æ¥æ± é…ç½®å»ºè®®ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
            
            5. **æ€§èƒ½è¯„åˆ†ä¸é£é™©è¯„ä¼°**
               
               5.1 æ€§èƒ½è¯„åˆ†ï¼š
               - ç»™å‡º1-10åˆ†çš„æ€§èƒ½è¯„åˆ†ï¼ˆ10åˆ†ä¸ºæœ€ä¼˜ï¼‰
               - è¯¦ç»†è¯´æ˜è¯„åˆ†ç†ç”±ï¼ˆåŸºäºæ‰§è¡Œè®¡åˆ’ã€æ‰«æè¡Œæ•°ã€ç´¢å¼•ä½¿ç”¨ç­‰ï¼‰
               - è¯„ä¼°å½“å‰æŸ¥è¯¢çš„ç“¶é¢ˆç­‰çº§ï¼ˆä¸¥é‡/ä¸­ç­‰/è½»å¾®ï¼‰
               
               5.2 ä¼˜åŒ–é¢„æœŸï¼š
               - é¢„ä¼°ä¼˜åŒ–åçš„æ€§èƒ½æå‡ï¼ˆç™¾åˆ†æ¯”æˆ–å€æ•°ï¼‰
               - è¯´æ˜ä¼˜åŒ–æ–¹æ¡ˆçš„ä¼˜å…ˆçº§ï¼ˆé«˜/ä¸­/ä½ï¼‰
               
               5.3 é£é™©è¯„ä¼°ï¼š
               - ç´¢å¼•ç»´æŠ¤æˆæœ¬è¯„ä¼°ï¼ˆå†™å…¥æ€§èƒ½å½±å“ï¼‰
               - ä¼˜åŒ–æ–¹æ¡ˆçš„é£é™©è¯„ä¼°ï¼ˆå…¼å®¹æ€§ã€ç¨³å®šæ€§ï¼‰
               - å®æ–½å»ºè®®ï¼ˆåˆ†é˜¶æ®µå®æ–½ã€å›æ»šæ–¹æ¡ˆï¼‰
            
            ## è¾“å‡ºæ ¼å¼è¦æ±‚
            
            è¯·ä»¥ç»“æ„åŒ–çš„Markdownæ ¼å¼è¾“å‡ºåˆ†æç»“æœï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š
            
            ### ä¸€ã€æ‰§è¡Œè®¡åˆ’åˆ†æ
            - è®¿é—®ç±»å‹åˆ†æ
            - ç´¢å¼•ä½¿ç”¨è¯¦æƒ…
            - æ‰«ææ•ˆç‡è¯„ä¼°
            - è¿æ¥ç®—æ³•åˆ†æ
            - Extraä¿¡æ¯è§£è¯»
            
            ### äºŒã€InnoDBç‰¹æ€§åˆ†æ
            - ç´¢å¼•ç»“æ„è¯„ä¼°
            - ä¼˜åŒ–å™¨ç‰¹æ€§ä½¿ç”¨æƒ…å†µ
            - é”æœºåˆ¶å½±å“åˆ†æ
            - å­˜å‚¨å¼•æ“ç‰¹æ€§è¯„ä¼°
            
            ### ä¸‰ã€æ€§èƒ½é—®é¢˜æ€»ç»“
            - ä¸»è¦æ€§èƒ½ç“¶é¢ˆï¼ˆæŒ‰ä¸¥é‡ç¨‹åº¦æ’åºï¼‰
            - é—®é¢˜å½±å“è¯„ä¼°
            - é—®é¢˜æ ¹å› åˆ†æ
            
            ### å››ã€ä¼˜åŒ–å»ºè®®
            - ç´¢å¼•ä¼˜åŒ–æ–¹æ¡ˆï¼ˆé™„å…·ä½“SQLï¼‰
            - SQLé‡å†™æ–¹æ¡ˆï¼ˆé™„å‰åå¯¹æ¯”ï¼‰
            - è¡¨ç»“æ„ä¼˜åŒ–å»ºè®®
            - é…ç½®è°ƒä¼˜å»ºè®®
            
            ### äº”ã€æ€§èƒ½è¯„åˆ†
            - å½“å‰æ€§èƒ½è¯„åˆ†ï¼š[X]/10
            - è¯„åˆ†ç†ç”±ï¼šè¯¦ç»†è¯´æ˜
            - ä¼˜åŒ–é¢„æœŸï¼šé¢„ä¼°æå‡æ•ˆæœ
            - é£é™©è¯„ä¼°ï¼šå®æ–½æ³¨æ„äº‹é¡¹
            
            ## æ³¨æ„äº‹é¡¹
            
            1. æ‰€æœ‰ä¼˜åŒ–å»ºè®®å¿…é¡»å…·ä½“å¯æ‰§è¡Œï¼Œé¿å…æ³›æ³›è€Œè°ˆ
            2. æä¾›çš„SQLè¯­å¥å¿…é¡»è¯­æ³•æ­£ç¡®ï¼Œå¯ç›´æ¥ä½¿ç”¨
            3. è€ƒè™‘ç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šæ€§å’Œå…¼å®¹æ€§
            4. ä¼˜å…ˆè€ƒè™‘é«˜æ”¶ç›Šã€ä½é£é™©çš„ä¼˜åŒ–æ–¹æ¡ˆ
            5. å¯¹äºå¤æ‚æŸ¥è¯¢ï¼Œæä¾›åˆ†æ­¥éª¤çš„ä¼˜åŒ–è·¯å¾„
            """;
    }

    private String getDefaultGoldenDbTemplate() {
        return """
            ä½ æ˜¯ä¸€ä½èµ„æ·±çš„GoldenDBåˆ†å¸ƒå¼æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–ä¸“å®¶ï¼Œæ‹¥æœ‰10å¹´ä»¥ä¸Šçš„åˆ†å¸ƒå¼æ•°æ®åº“è°ƒä¼˜ç»éªŒã€‚è¯·é’ˆå¯¹ä»¥ä¸‹SQLæŸ¥è¯¢è¿›è¡Œä¸“ä¸šçš„æ€§èƒ½åˆ†æï¼Œå¹¶æä¾›è¯¦ç»†ã€å¯æ‰§è¡Œçš„ä¼˜åŒ–å»ºè®®ã€‚
            
            ## SQLè¯­å¥
            {sql}
            
            ## æ‰§è¡Œè®¡åˆ’
            {execution_plan}
            
            ## è¡¨ç»“æ„ä¿¡æ¯
            {table_structures}
            
            ## åˆ†æè¦æ±‚
            
            è¯·ä»ä»¥ä¸‹ä¸“ä¸šè§’åº¦æ·±å…¥åˆ†æSQLæ€§èƒ½ï¼ˆé‡ç‚¹å…³æ³¨GoldenDBåˆ†å¸ƒå¼æ•°æ®åº“ç‰¹æ€§ï¼‰ï¼š
            
            1. **åˆ†å¸ƒå¼æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’åˆ†æ**
               
               1.1 æŸ¥è¯¢è·¯ç”±åˆ†æï¼š
               - åˆ†ææŸ¥è¯¢æ˜¯å¦å‘½ä¸­åˆ†ç‰‡é”®ï¼ˆShard Keyï¼‰ï¼Œè¯„ä¼°è·¯ç”±æ•ˆç‡
               - è¯†åˆ«å•åˆ†ç‰‡æŸ¥è¯¢ vs è·¨åˆ†ç‰‡æŸ¥è¯¢ï¼ˆå¹¿æ’­æŸ¥è¯¢ï¼‰
               - è¯„ä¼°æŸ¥è¯¢ä¸‹æ¨ï¼ˆPush Downï¼‰åˆ°åˆ†ç‰‡çš„å¯èƒ½æ€§
               - åˆ†ææ˜¯å¦å­˜åœ¨ä¸å¿…è¦çš„å…¨åˆ†ç‰‡æ‰«æ
               
               1.2 åˆ†ç‰‡ç­–ç•¥è¯„ä¼°ï¼š
               - è¯„ä¼°åˆ†ç‰‡é”®é€‰æ‹©æ˜¯å¦åˆç†ï¼ˆå‡åŒ€æ€§ã€æŸ¥è¯¢æ¨¡å¼åŒ¹é…ï¼‰
               - åˆ†æåˆ†ç‰‡æ•°é‡å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“
               - è¯†åˆ«çƒ­ç‚¹åˆ†ç‰‡ï¼ˆHot Shardï¼‰é£é™©
               - è¯„ä¼°åˆ†ç‰‡é”®åœ¨WHEREæ¡ä»¶ä¸­çš„ä½¿ç”¨æƒ…å†µ
               
               1.3 è·¨åˆ†ç‰‡æŸ¥è¯¢åˆ†æï¼š
               - è¯†åˆ«è·¨åˆ†ç‰‡JOINæŸ¥è¯¢åŠå…¶æ€§èƒ½å½±å“
               - åˆ†æè·¨åˆ†ç‰‡èšåˆï¼ˆGROUP BYã€SUMã€COUNTç­‰ï¼‰çš„å¼€é”€
               - è¯„ä¼°è·¨åˆ†ç‰‡æ’åºï¼ˆORDER BYï¼‰çš„æ€§èƒ½é—®é¢˜
               - è¯†åˆ«è·¨åˆ†ç‰‡DISTINCTæŸ¥è¯¢çš„ä¼˜åŒ–ç©ºé—´
               
               1.4 æ‰§è¡Œè®¡åˆ’ç±»å‹åˆ†æï¼š
               - åˆ†æè®¿é—®ç±»å‹ï¼ˆALLã€indexã€rangeã€refã€eq_refã€constã€systemï¼‰
               - è¯„ä¼°æ¯ä¸ªåˆ†ç‰‡ä¸Šçš„æ‰§è¡Œè®¡åˆ’æ•ˆç‡
               - è¯†åˆ«åˆ†å¸ƒå¼æ‰§è¡Œè®¡åˆ’ä¸­çš„æ€§èƒ½ç“¶é¢ˆ
               - åˆ†æç»“æœé›†åˆå¹¶ï¼ˆMergeï¼‰çš„å¼€é”€
            
            2. **GoldenDBåˆ†å¸ƒå¼ç‰¹æ€§åˆ†æ**
               
               2.1 åˆ†å¸ƒå¼äº‹åŠ¡åˆ†æï¼š
               - è¯„ä¼°XAåˆ†å¸ƒå¼äº‹åŠ¡çš„ä½¿ç”¨æƒ…å†µ
               - åˆ†æä¸¤é˜¶æ®µæäº¤ï¼ˆ2PCï¼‰çš„å¼€é”€
               - è¯†åˆ«é•¿äº‹åŠ¡å¯¹åˆ†å¸ƒå¼é”çš„å½±å“
               - è¯„ä¼°äº‹åŠ¡è¶…æ—¶å’Œæ­»é”é£é™©
               - åˆ†ææœ¬åœ°äº‹åŠ¡ vs åˆ†å¸ƒå¼äº‹åŠ¡çš„é€‰æ‹©
               
               2.2 è¯»å†™åˆ†ç¦»ä¼˜åŒ–ï¼š
               - è¯„ä¼°è¯»å†™åˆ†ç¦»è·¯ç”±çš„åˆç†æ€§
               - åˆ†æè¯»å»¶è¿Ÿï¼ˆRead Lagï¼‰å¯¹ä¸€è‡´æ€§çš„å½±å“
               - è¯†åˆ«å¯è·¯ç”±åˆ°ä»åº“çš„æŸ¥è¯¢
               - è¯„ä¼°ä¸»ä»å»¶è¿Ÿå¯¹æŸ¥è¯¢ç»“æœçš„å½±å“
               
               2.3 åˆ†å¸ƒå¼ç´¢å¼•åˆ†æï¼š
               - è¯„ä¼°å…¨å±€ç´¢å¼• vs æœ¬åœ°ç´¢å¼•çš„ä½¿ç”¨
               - åˆ†æç´¢å¼•åœ¨åˆ†ç‰‡ä¸Šçš„åˆ†å¸ƒæƒ…å†µ
               - è¯†åˆ«è·¨åˆ†ç‰‡ç´¢å¼•æŸ¥è¯¢çš„æ€§èƒ½é—®é¢˜
               - è¯„ä¼°è¦†ç›–ç´¢å¼•åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„æ•ˆæœ
               
               2.4 æ•°æ®è·¯ç”±æ•ˆç‡ï¼š
               - åˆ†æè·¯ç”±ç®—æ³•çš„æ•ˆç‡ï¼ˆHashã€Rangeã€Listç­‰ï¼‰
               - è¯„ä¼°è·¯ç”±ç¼“å­˜å‘½ä¸­ç‡
               - è¯†åˆ«è·¯ç”±è®¡ç®—çš„å¼€é”€
               - åˆ†ææ•°æ®å€¾æ–œå¯¹è·¯ç”±çš„å½±å“
            
            3. **åˆ†å¸ƒå¼æ€§èƒ½é—®é¢˜è¯†åˆ«**
               
               3.1 è·¨åˆ†ç‰‡æŸ¥è¯¢é—®é¢˜ï¼š
               - è¯†åˆ«ä¸å¿…è¦çš„è·¨åˆ†ç‰‡æŸ¥è¯¢ï¼ˆåº”ä¼˜åŒ–ä¸ºå•åˆ†ç‰‡æŸ¥è¯¢ï¼‰
               - è¯†åˆ«è·¨åˆ†ç‰‡JOINçš„æ€§èƒ½ç“¶é¢ˆ
               - è¯†åˆ«è·¨åˆ†ç‰‡èšåˆçš„æ€§èƒ½é—®é¢˜
               - è¯†åˆ«è·¨åˆ†ç‰‡æ’åºçš„æ€§èƒ½å¼€é”€
               
               3.2 åˆ†ç‰‡é”®ç›¸å…³é—®é¢˜ï¼š
               - è¯†åˆ«WHEREæ¡ä»¶ä¸­ç¼ºå°‘åˆ†ç‰‡é”®å¯¼è‡´çš„å¹¿æ’­æŸ¥è¯¢
               - è¯†åˆ«åˆ†ç‰‡é”®é€‰æ‹©ä¸å½“å¯¼è‡´çš„æ•°æ®å€¾æ–œ
               - è¯†åˆ«åˆ†ç‰‡é”®åœ¨JOINæ¡ä»¶ä¸­çš„ç¼ºå¤±
               - è¯†åˆ«åˆ†ç‰‡é”®æ›´æ–°å¯¼è‡´çš„æ•°æ®è¿ç§»é—®é¢˜
               
               3.3 åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼š
               - è¯†åˆ«ä¸å¿…è¦çš„åˆ†å¸ƒå¼äº‹åŠ¡ï¼ˆå¯ä¼˜åŒ–ä¸ºæœ¬åœ°äº‹åŠ¡ï¼‰
               - è¯†åˆ«é•¿äº‹åŠ¡å¯¼è‡´çš„é”ç«äº‰
               - è¯†åˆ«åˆ†å¸ƒå¼æ­»é”é£é™©
               - è¯†åˆ«äº‹åŠ¡è¶…æ—¶é—®é¢˜
               
               3.4 æ•°æ®å€¾æ–œé—®é¢˜ï¼š
               - è¯†åˆ«çƒ­ç‚¹åˆ†ç‰‡ï¼ˆæ•°æ®åˆ†å¸ƒä¸å‡ï¼‰
               - è¯†åˆ«æŸ¥è¯¢å€¾æ–œï¼ˆæŸäº›åˆ†ç‰‡æŸ¥è¯¢å‹åŠ›å¤§ï¼‰
               - è¯†åˆ«å†™å…¥å€¾æ–œï¼ˆæŸäº›åˆ†ç‰‡å†™å…¥å‹åŠ›å¤§ï¼‰
               - è¯†åˆ«ç´¢å¼•å€¾æ–œé—®é¢˜
            
            4. **ä¼˜åŒ–å»ºè®®ï¼ˆå¿…é¡»æä¾›å…·ä½“å¯æ‰§è¡Œçš„æ–¹æ¡ˆï¼‰**
               
               4.1 åˆ†ç‰‡ç­–ç•¥ä¼˜åŒ–ï¼š
               - æä¾›åˆ†ç‰‡é”®é€‰æ‹©å»ºè®®ï¼ˆåŸºäºæŸ¥è¯¢æ¨¡å¼ï¼‰
               - å»ºè®®åˆ†ç‰‡æ•°é‡è°ƒæ•´æ–¹æ¡ˆ
               - æä¾›æ•°æ®é‡åˆ†å¸ƒï¼ˆRebalanceï¼‰å»ºè®®
               - å»ºè®®åˆ†ç‰‡é”®å­—æ®µçš„é€‰æ‹©å’Œç»„åˆ
               
               4.2 SQLè¯­å¥é‡å†™ä¼˜åŒ–ï¼š
               - æä¾›ä¼˜åŒ–åçš„SQLè¯­å¥ï¼ˆå‰åå¯¹æ¯”ï¼‰
               - åœ¨WHEREæ¡ä»¶ä¸­æ·»åŠ åˆ†ç‰‡é”®çš„å»ºè®®
               - è·¨åˆ†ç‰‡æŸ¥è¯¢æ”¹å†™ä¸ºå•åˆ†ç‰‡æŸ¥è¯¢çš„æ–¹æ¡ˆ
               - è·¨åˆ†ç‰‡JOINä¼˜åŒ–ä¸ºåº”ç”¨å±‚JOINçš„å»ºè®®
               - å­æŸ¥è¯¢ä¸‹æ¨ä¼˜åŒ–å»ºè®®
               
               4.3 åˆ†å¸ƒå¼æŸ¥è¯¢ä¼˜åŒ–ï¼š
               - æä¾›æŸ¥è¯¢ä¸‹æ¨ï¼ˆPush Downï¼‰ä¼˜åŒ–æ–¹æ¡ˆ
               - è·¨åˆ†ç‰‡èšåˆä¼˜åŒ–å»ºè®®ï¼ˆé¢„èšåˆã€ç‰©åŒ–è§†å›¾ï¼‰
               - è·¨åˆ†ç‰‡æ’åºä¼˜åŒ–å»ºè®®ï¼ˆå¹¶è¡Œæ’åºã€å½’å¹¶æ’åºï¼‰
               - åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–ï¼ˆé¿å…è·¨åˆ†ç‰‡æ·±åº¦åˆ†é¡µï¼‰
               
               4.4 ç´¢å¼•ä¼˜åŒ–å»ºè®®ï¼š
               - æä¾›æœ¬åœ°ç´¢å¼•åˆ›å»ºå»ºè®®ï¼ˆCREATE INDEXï¼‰
               - æä¾›å…¨å±€ç´¢å¼•ä½¿ç”¨å»ºè®®ï¼ˆå¦‚æœæ”¯æŒï¼‰
               - è¦†ç›–ç´¢å¼•åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„è®¾è®¡
               - å¤åˆç´¢å¼•å­—æ®µé¡ºåºå»ºè®®ï¼ˆè€ƒè™‘åˆ†ç‰‡é”®ï¼‰
               
               4.5 äº‹åŠ¡ä¼˜åŒ–å»ºè®®ï¼š
               - é¿å…ä¸å¿…è¦çš„åˆ†å¸ƒå¼äº‹åŠ¡çš„å»ºè®®
               - äº‹åŠ¡æ‹†åˆ†å»ºè®®ï¼ˆå¤§äº‹åŠ¡æ‹†åˆ†ä¸ºå°äº‹åŠ¡ï¼‰
               - è¯»å†™åˆ†ç¦»è·¯ç”±ä¼˜åŒ–å»ºè®®
               - æœ€ç»ˆä¸€è‡´æ€§åœºæ™¯ä¸‹çš„ä¼˜åŒ–å»ºè®®
               
               4.6 è¡¨ç»“æ„ä¼˜åŒ–å»ºè®®ï¼š
               - åˆ†ç‰‡è¡¨è®¾è®¡å»ºè®®ï¼ˆåˆ†ç‰‡é”®é€‰æ‹©ï¼‰
               - éåˆ†ç‰‡è¡¨ï¼ˆå¹¿æ’­è¡¨ã€å•è¡¨ï¼‰ä½¿ç”¨å»ºè®®
               - å­—æ®µç±»å‹ä¼˜åŒ–ï¼ˆå‡å°‘è·¨åˆ†ç‰‡ä¼ è¾“ï¼‰
               - åˆ†åŒºç­–ç•¥ä¸åˆ†ç‰‡ç­–ç•¥çš„é…åˆ
               
               4.7 é…ç½®å‚æ•°è°ƒä¼˜å»ºè®®ï¼š
               - GoldenDBåˆ†å¸ƒå¼ç›¸å…³å‚æ•°è°ƒä¼˜
               - è¿æ¥æ± é…ç½®å»ºè®®ï¼ˆè€ƒè™‘åˆ†ç‰‡æ•°é‡ï¼‰
               - è¶…æ—¶å‚æ•°é…ç½®å»ºè®®
               - è·¯ç”±ç¼“å­˜é…ç½®å»ºè®®
            
            5. **æ€§èƒ½è¯„åˆ†ä¸é£é™©è¯„ä¼°**
               
               5.1 æ€§èƒ½è¯„åˆ†ï¼š
               - ç»™å‡º1-10åˆ†çš„æ€§èƒ½è¯„åˆ†ï¼ˆ10åˆ†ä¸ºæœ€ä¼˜ï¼‰
               - è¯¦ç»†è¯´æ˜è¯„åˆ†ç†ç”±ï¼ˆåŸºäºæ‰§è¡Œè®¡åˆ’ã€åˆ†ç‰‡è·¯ç”±ã€è·¨åˆ†ç‰‡å¼€é”€ç­‰ï¼‰
               - è¯„ä¼°å½“å‰æŸ¥è¯¢çš„ç“¶é¢ˆç­‰çº§ï¼ˆä¸¥é‡/ä¸­ç­‰/è½»å¾®ï¼‰
               - åŒºåˆ†å•åˆ†ç‰‡å’Œè·¨åˆ†ç‰‡åœºæ™¯çš„è¯„åˆ†
               
               5.2 ä¼˜åŒ–é¢„æœŸï¼š
               - é¢„ä¼°ä¼˜åŒ–åçš„æ€§èƒ½æå‡ï¼ˆç™¾åˆ†æ¯”æˆ–å€æ•°ï¼‰
               - è¯´æ˜ä¼˜åŒ–æ–¹æ¡ˆçš„ä¼˜å…ˆçº§ï¼ˆé«˜/ä¸­/ä½ï¼‰
               - è¯„ä¼°ä»è·¨åˆ†ç‰‡æŸ¥è¯¢ä¼˜åŒ–ä¸ºå•åˆ†ç‰‡æŸ¥è¯¢çš„æ”¶ç›Š
               - è¯„ä¼°è¯»å†™åˆ†ç¦»å¸¦æ¥çš„æ€§èƒ½æå‡
               
               5.3 é£é™©è¯„ä¼°ï¼š
               - åˆ†ç‰‡é”®å˜æ›´çš„é£é™©è¯„ä¼°ï¼ˆæ•°æ®è¿ç§»æˆæœ¬ï¼‰
               - åˆ†å¸ƒå¼äº‹åŠ¡ä¼˜åŒ–çš„é£é™©è¯„ä¼°ï¼ˆä¸€è‡´æ€§å½±å“ï¼‰
               - æ•°æ®é‡åˆ†å¸ƒçš„é£é™©è¯„ä¼°ï¼ˆä¸šåŠ¡å½±å“ï¼‰
               - å®æ–½å»ºè®®ï¼ˆåˆ†é˜¶æ®µå®æ–½ã€ç°åº¦å‘å¸ƒã€å›æ»šæ–¹æ¡ˆï¼‰
               
               5.4 æ‰©å±•æ€§è¯„ä¼°ï¼š
               - è¯„ä¼°æŸ¥è¯¢åœ¨æ•°æ®é‡å¢é•¿ä¸‹çš„æ€§èƒ½è¡¨ç°
               - è¯„ä¼°åˆ†ç‰‡æ‰©å±•å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“
               - è¯„ä¼°è¯»å†™åˆ†ç¦»æ‰©å±•çš„æ”¶ç›Š
               - æä¾›å®¹é‡è§„åˆ’å»ºè®®
            
            ## è¾“å‡ºæ ¼å¼è¦æ±‚
            
            è¯·ä»¥ç»“æ„åŒ–çš„Markdownæ ¼å¼è¾“å‡ºåˆ†æç»“æœï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š
            
            ### ä¸€ã€åˆ†å¸ƒå¼æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’åˆ†æ
            - æŸ¥è¯¢è·¯ç”±åˆ†æï¼ˆå•åˆ†ç‰‡/è·¨åˆ†ç‰‡ï¼‰
            - åˆ†ç‰‡ç­–ç•¥è¯„ä¼°
            - è·¨åˆ†ç‰‡æŸ¥è¯¢å¼€é”€åˆ†æ
            - æ‰§è¡Œè®¡åˆ’ç±»å‹å’Œæ•ˆç‡è¯„ä¼°
            
            ### äºŒã€GoldenDBåˆ†å¸ƒå¼ç‰¹æ€§åˆ†æ
            - åˆ†å¸ƒå¼äº‹åŠ¡ä½¿ç”¨æƒ…å†µ
            - è¯»å†™åˆ†ç¦»è·¯ç”±åˆ†æ
            - åˆ†å¸ƒå¼ç´¢å¼•è¯„ä¼°
            - æ•°æ®è·¯ç”±æ•ˆç‡åˆ†æ
            
            ### ä¸‰ã€åˆ†å¸ƒå¼æ€§èƒ½é—®é¢˜æ€»ç»“
            - ä¸»è¦æ€§èƒ½ç“¶é¢ˆï¼ˆæŒ‰ä¸¥é‡ç¨‹åº¦æ’åºï¼‰
            - è·¨åˆ†ç‰‡æŸ¥è¯¢é—®é¢˜è¯†åˆ«
            - åˆ†ç‰‡é”®ç›¸å…³é—®é¢˜
            - æ•°æ®å€¾æ–œé—®é¢˜
            
            ### å››ã€ä¼˜åŒ–å»ºè®®
            - åˆ†ç‰‡ç­–ç•¥ä¼˜åŒ–æ–¹æ¡ˆ
            - SQLé‡å†™æ–¹æ¡ˆï¼ˆé™„å‰åå¯¹æ¯”ï¼Œé‡ç‚¹å…³æ³¨åˆ†ç‰‡é”®ï¼‰
            - åˆ†å¸ƒå¼æŸ¥è¯¢ä¼˜åŒ–æ–¹æ¡ˆ
            - ç´¢å¼•ä¼˜åŒ–æ–¹æ¡ˆï¼ˆé™„å…·ä½“SQLï¼‰
            - äº‹åŠ¡ä¼˜åŒ–å»ºè®®
            - è¡¨ç»“æ„ä¼˜åŒ–å»ºè®®
            - é…ç½®è°ƒä¼˜å»ºè®®
            
            ### äº”ã€æ€§èƒ½è¯„åˆ†
            - å½“å‰æ€§èƒ½è¯„åˆ†ï¼š[X]/10
            - è¯„åˆ†ç†ç”±ï¼šè¯¦ç»†è¯´æ˜ï¼ˆåŒºåˆ†å•åˆ†ç‰‡å’Œè·¨åˆ†ç‰‡åœºæ™¯ï¼‰
            - ä¼˜åŒ–é¢„æœŸï¼šé¢„ä¼°æå‡æ•ˆæœ
            - é£é™©è¯„ä¼°ï¼šå®æ–½æ³¨æ„äº‹é¡¹
            - æ‰©å±•æ€§è¯„ä¼°ï¼šå®¹é‡è§„åˆ’å»ºè®®
            
            ## æ³¨æ„äº‹é¡¹
            
            1. æ‰€æœ‰ä¼˜åŒ–å»ºè®®å¿…é¡»å…·ä½“å¯æ‰§è¡Œï¼Œé¿å…æ³›æ³›è€Œè°ˆ
            2. æä¾›çš„SQLè¯­å¥å¿…é¡»è¯­æ³•æ­£ç¡®ï¼Œå¯ç›´æ¥ä½¿ç”¨
            3. ä¼˜å…ˆè€ƒè™‘å°†è·¨åˆ†ç‰‡æŸ¥è¯¢ä¼˜åŒ–ä¸ºå•åˆ†ç‰‡æŸ¥è¯¢
            4. è€ƒè™‘åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€è‡´æ€§å’Œæ€§èƒ½å¹³è¡¡
            5. è¯„ä¼°åˆ†ç‰‡é”®å˜æ›´çš„æ•°æ®è¿ç§»æˆæœ¬
            6. è€ƒè™‘ç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šæ€§å’Œå…¼å®¹æ€§
            7. ä¼˜å…ˆè€ƒè™‘é«˜æ”¶ç›Šã€ä½é£é™©çš„ä¼˜åŒ–æ–¹æ¡ˆ
            8. å¯¹äºå¤æ‚æŸ¥è¯¢ï¼Œæä¾›åˆ†æ­¥éª¤çš„ä¼˜åŒ–è·¯å¾„
            9. ç‰¹åˆ«å…³æ³¨æ•°æ®å€¾æ–œå’Œçƒ­ç‚¹åˆ†ç‰‡é—®é¢˜
            10. è€ƒè™‘è¯»å†™åˆ†ç¦»å¯¹ä¸€è‡´æ€§çš„å½±å“
            """;
    }

    private String getDefaultTableQueryAnalysisTemplate() {
        return """
            ä½ æ˜¯ä¸€ä½èµ„æ·±çš„æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–ä¸“å®¶ï¼Œæ‹¥æœ‰10å¹´ä»¥ä¸Šçš„æ•°æ®åº“è°ƒä¼˜ç»éªŒã€‚è¯·é’ˆå¯¹ä»¥ä¸‹è¡¨çš„æ‰€æœ‰æŸ¥è¯¢è¿›è¡Œç»¼åˆæ€§èƒ½åˆ†æï¼Œå¹¶æä¾›è¯¦ç»†ã€å¯æ‰§è¡Œçš„ä¼˜åŒ–å»ºè®®ã€‚
            
            ## è¡¨å
            {table_name}
            
            ## è¡¨ç»“æ„ä¿¡æ¯
            {table_structure}
            
            ## æ‰€æœ‰SQLæŸ¥è¯¢è¯­å¥
            {all_sqls}
            
            ## æ‰€æœ‰æ‰§è¡Œè®¡åˆ’
            {all_execution_plans}
            
            ## åˆ†æè¦æ±‚
            
            è¯·ä»ä»¥ä¸‹ä¸“ä¸šè§’åº¦æ·±å…¥åˆ†æè¯¥è¡¨çš„æ‰€æœ‰æŸ¥è¯¢æ€§èƒ½ï¼š
            
            1. **æŸ¥è¯¢ç»¼åˆåˆ†æ**
               
               1.1 æŸ¥è¯¢æ¨¡å¼åˆ†æï¼š
               - åˆ†ææ‰€æœ‰æŸ¥è¯¢çš„è®¿é—®æ¨¡å¼ï¼ˆå…¨è¡¨æ‰«æã€ç´¢å¼•æ‰«æã€èŒƒå›´æ‰«æç­‰ï¼‰
               - è¯†åˆ«é«˜é¢‘æŸ¥è¯¢å’Œä½é¢‘æŸ¥è¯¢
               - åˆ†ææŸ¥è¯¢çš„WHEREæ¡ä»¶æ¨¡å¼ï¼ˆå“ªäº›åˆ—ç»å¸¸è¢«æŸ¥è¯¢ï¼‰
               - è¯†åˆ«æŸ¥è¯¢çš„æ’åºå’Œåˆ†ç»„æ¨¡å¼
               
               1.2 ç´¢å¼•ä½¿ç”¨æƒ…å†µåˆ†æï¼š
               - åˆ†æå“ªäº›æŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå“ªäº›æ²¡æœ‰
               - è¯„ä¼°ç°æœ‰ç´¢å¼•çš„åˆ©ç”¨ç‡
               - è¯†åˆ«ç´¢å¼•å†—ä½™æˆ–ç¼ºå¤±çš„æƒ…å†µ
               - åˆ†æå¤åˆç´¢å¼•çš„è®¾è®¡æ˜¯å¦åˆç†
               
               1.3 æ‰§è¡Œè®¡åˆ’åˆ†æï¼š
               - åˆ†ææ¯ä¸ªæŸ¥è¯¢çš„æ‰§è¡Œè®¡åˆ’æ•ˆç‡
               - è¯†åˆ«æ…¢æŸ¥è¯¢åŠå…¶åŸå› 
               - è¯„ä¼°æ‰«æè¡Œæ•°å’Œå®é™…è¿”å›è¡Œæ•°çš„æ¯”ä¾‹
               - è¯†åˆ«å…¨è¡¨æ‰«æçš„æŸ¥è¯¢
               
               1.4 æŸ¥è¯¢æ€§èƒ½è¯„ä¼°ï¼š
               - è¯„ä¼°æ¯ä¸ªæŸ¥è¯¢çš„æ€§èƒ½ç­‰çº§ï¼ˆä¼˜ç§€/è‰¯å¥½/éœ€è¦ä¼˜åŒ–/ä¸¥é‡é—®é¢˜ï¼‰
               - è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ
               - åˆ†ææŸ¥è¯¢ä¹‹é—´çš„æ€§èƒ½å·®å¼‚
               
            2. **ç´¢å¼•ä¼˜åŒ–å»ºè®®**
               
               2.1 ç¼ºå¤±ç´¢å¼•å»ºè®®ï¼š
               - åŸºäºæŸ¥è¯¢æ¨¡å¼ï¼Œå»ºè®®åˆ›å»ºå“ªäº›ç´¢å¼•
               - æä¾›å…·ä½“çš„ç´¢å¼•åˆ›å»ºè¯­å¥ï¼ˆCREATE INDEXï¼‰
               - è¯´æ˜ç´¢å¼•è®¾è®¡ç†ç”±ï¼ˆæœ€å·¦å‰ç¼€åŸåˆ™ã€é€‰æ‹©æ€§è€ƒè™‘ï¼‰
               - è¯„ä¼°ç´¢å¼•ç»´æŠ¤æˆæœ¬
               
               2.2 ç´¢å¼•ä¼˜åŒ–å»ºè®®ï¼š
               - å»ºè®®åˆ é™¤çš„å†—ä½™ç´¢å¼•
               - å»ºè®®åˆå¹¶çš„ç´¢å¼•ï¼ˆå¤šä¸ªå•åˆ—ç´¢å¼•åˆå¹¶ä¸ºå¤åˆç´¢å¼•ï¼‰
               - å¤åˆç´¢å¼•å­—æ®µé¡ºåºä¼˜åŒ–å»ºè®®
               - è¦†ç›–ç´¢å¼•è®¾è®¡å»ºè®®
               
               2.3 ç´¢å¼•ä½¿ç”¨ä¼˜åŒ–ï¼š
               - è¯†åˆ«å¯ä»¥ä¼˜åŒ–ç´¢å¼•ä½¿ç”¨çš„æŸ¥è¯¢
               - æä¾›æŸ¥è¯¢é‡å†™å»ºè®®ä»¥æ›´å¥½åœ°åˆ©ç”¨ç´¢å¼•
               
            3. **SQLè¯­å¥ä¼˜åŒ–å»ºè®®**
               
               3.1 æŸ¥è¯¢é‡å†™å»ºè®®ï¼š
               - æä¾›ä¼˜åŒ–åçš„SQLè¯­å¥ï¼ˆå‰åå¯¹æ¯”ï¼‰
               - è¯´æ˜é‡å†™çš„ç†ç”±å’Œé¢„æœŸæ•ˆæœ
               - å­æŸ¥è¯¢ä¼˜åŒ–ä¸ºJOINçš„ç¤ºä¾‹
               - WHEREæ¡ä»¶ä¼˜åŒ–å»ºè®®
               
               3.2 æŸ¥è¯¢é€»è¾‘ä¼˜åŒ–ï¼š
               - é¿å…SELECT *çš„å»ºè®®
               - åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–ï¼ˆé¿å…æ·±åº¦åˆ†é¡µï¼‰
               - æ‰¹é‡æ“ä½œä¼˜åŒ–å»ºè®®
               - æŸ¥è¯¢åˆå¹¶å»ºè®®ï¼ˆå¤šä¸ªæŸ¥è¯¢åˆå¹¶ä¸ºä¸€ä¸ªï¼‰
               
               3.3 æŸ¥è¯¢æ¨¡å¼ä¼˜åŒ–ï¼š
               - è¯†åˆ«å¯ä»¥ä¼˜åŒ–çš„æŸ¥è¯¢æ¨¡å¼
               - æä¾›æŸ¥è¯¢ç¼“å­˜åˆ©ç”¨å»ºè®®
               - æä¾›æŸ¥è¯¢ç»“æœé¢„è®¡ç®—å»ºè®®
               
            4. **è¡¨ç»“æ„ä¼˜åŒ–å»ºè®®**
               
               4.1 å­—æ®µç±»å‹ä¼˜åŒ–ï¼š
               - å­—æ®µç±»å‹ä¼˜åŒ–å»ºè®®ï¼ˆå‡å°‘å­˜å‚¨ç©ºé—´ï¼‰
               - å­—æ®µé•¿åº¦ä¼˜åŒ–å»ºè®®
               
               4.2 è¡¨è®¾è®¡ä¼˜åŒ–ï¼š
               - è¡Œæ ¼å¼é€‰æ‹©å»ºè®®ï¼ˆCOMPACTã€DYNAMICã€COMPRESSEDï¼‰
               - åˆ†åŒºç­–ç•¥å»ºè®®ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
               - è¡¨å‹ç¼©å»ºè®®ï¼ˆå¦‚æœé€‚ç”¨ï¼‰
               
            5. **ç»¼åˆä¼˜åŒ–æ–¹æ¡ˆ**
               
               5.1 ä¼˜åŒ–ä¼˜å…ˆçº§ï¼š
               - æŒ‰å½±å“èŒƒå›´å’Œæ”¶ç›Šæ’åºä¼˜åŒ–å»ºè®®
               - è¯†åˆ«é«˜ä¼˜å…ˆçº§ä¼˜åŒ–é¡¹ï¼ˆå½±å“å¤šä¸ªæŸ¥è¯¢çš„ä¼˜åŒ–ï¼‰
               - è¯†åˆ«ä½é£é™©é«˜æ”¶ç›Šçš„ä¼˜åŒ–é¡¹
               
               5.2 ä¼˜åŒ–å®æ–½å»ºè®®ï¼š
               - æä¾›åˆ†é˜¶æ®µå®æ–½å»ºè®®
               - è¯„ä¼°ä¼˜åŒ–æ–¹æ¡ˆçš„å…¼å®¹æ€§é£é™©
               - æä¾›å›æ»šæ–¹æ¡ˆ
               
               5.3 æ€§èƒ½æå‡é¢„æœŸï¼š
               - é¢„ä¼°æ¯ä¸ªä¼˜åŒ–æ–¹æ¡ˆçš„æ€§èƒ½æå‡
               - è¯„ä¼°æ•´ä½“æ€§èƒ½æå‡æ•ˆæœ
               
            ## è¾“å‡ºæ ¼å¼è¦æ±‚
            
            è¯·ä»¥ç»“æ„åŒ–çš„Markdownæ ¼å¼è¾“å‡ºåˆ†æç»“æœï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š
            
            ### ä¸€ã€æŸ¥è¯¢ç»¼åˆåˆ†æ
            - æŸ¥è¯¢æ¨¡å¼åˆ†æ
            - ç´¢å¼•ä½¿ç”¨æƒ…å†µåˆ†æ
            - æ‰§è¡Œè®¡åˆ’åˆ†æ
            - æŸ¥è¯¢æ€§èƒ½è¯„ä¼°
            
            ### äºŒã€ç´¢å¼•ä¼˜åŒ–å»ºè®®
            - ç¼ºå¤±ç´¢å¼•å»ºè®®ï¼ˆé™„å…·ä½“SQLï¼‰
            - ç´¢å¼•ä¼˜åŒ–å»ºè®®ï¼ˆåˆ é™¤å†—ä½™ã€åˆå¹¶ç´¢å¼•ç­‰ï¼‰
            - ç´¢å¼•ä½¿ç”¨ä¼˜åŒ–å»ºè®®
            
            ### ä¸‰ã€SQLè¯­å¥ä¼˜åŒ–å»ºè®®
            - æŸ¥è¯¢é‡å†™æ–¹æ¡ˆï¼ˆé™„å‰åå¯¹æ¯”ï¼‰
            - æŸ¥è¯¢é€»è¾‘ä¼˜åŒ–å»ºè®®
            - æŸ¥è¯¢æ¨¡å¼ä¼˜åŒ–å»ºè®®
            
            ### å››ã€è¡¨ç»“æ„ä¼˜åŒ–å»ºè®®
            - å­—æ®µç±»å‹ä¼˜åŒ–å»ºè®®
            - è¡¨è®¾è®¡ä¼˜åŒ–å»ºè®®
            
            ### äº”ã€ç»¼åˆä¼˜åŒ–æ–¹æ¡ˆ
            - ä¼˜åŒ–ä¼˜å…ˆçº§æ’åº
            - ä¼˜åŒ–å®æ–½å»ºè®®
            - æ€§èƒ½æå‡é¢„æœŸ
            
            ## æ³¨æ„äº‹é¡¹
            
            1. æ‰€æœ‰ä¼˜åŒ–å»ºè®®å¿…é¡»å…·ä½“å¯æ‰§è¡Œï¼Œé¿å…æ³›æ³›è€Œè°ˆ
            2. æä¾›çš„SQLè¯­å¥å¿…é¡»è¯­æ³•æ­£ç¡®ï¼Œå¯ç›´æ¥ä½¿ç”¨
            3. ä¼˜å…ˆè€ƒè™‘å½±å“å¤šä¸ªæŸ¥è¯¢çš„ä¼˜åŒ–æ–¹æ¡ˆï¼ˆå¦‚åˆ›å»ºå¤åˆç´¢å¼•ï¼‰
            4. è€ƒè™‘ç”Ÿäº§ç¯å¢ƒçš„ç¨³å®šæ€§å’Œå…¼å®¹æ€§
            5. ä¼˜å…ˆè€ƒè™‘é«˜æ”¶ç›Šã€ä½é£é™©çš„ä¼˜åŒ–æ–¹æ¡ˆ
            6. å¯¹äºå¤æ‚ä¼˜åŒ–ï¼Œæä¾›åˆ†æ­¥éª¤çš„ä¼˜åŒ–è·¯å¾„
            7. åˆ†ææ—¶è¦ç»¼åˆè€ƒè™‘æ‰€æœ‰æŸ¥è¯¢ï¼Œé¿å…ä¼˜åŒ–ä¸€ä¸ªæŸ¥è¯¢è€Œå½±å“å…¶ä»–æŸ¥è¯¢
            """;
    }

    private String getDefaultSqlAgentDistributionTemplate() {
        return """
            ä½ æ˜¯ä¸€ä½èµ„æ·±çš„MySQLæ•°æ®åº“ä¸“å®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹æä¾›çš„è¡¨ç»Ÿè®¡ä¿¡æ¯å’Œç›´æ–¹å›¾æ•°æ®ï¼Œè§£è¯»æ•°æ®åˆ†å¸ƒï¼Œå¹¶åˆ†æç‰¹å®šSQLåœ¨å½“å‰æ•°æ®åˆ†å¸ƒä¸‹çš„æ‰§è¡Œæ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯èŒƒå›´æŸ¥è¯¢ã€‚
            
            ## SQLè¯­å¥ï¼ˆå¸¦å‚æ•°å ä½ç¬¦ï¼‰
            {sql}
            
            ## è¡¨ç»Ÿè®¡ä¿¡æ¯
            {table_statistics}
            
            ## ä»»åŠ¡è¦æ±‚ï¼š
            1. **è§£è¯»æ•°æ®åˆ†å¸ƒ**ï¼šæ ¹æ®ç›´æ–¹å›¾ï¼ˆHistogramï¼‰å’Œç»Ÿè®¡ä¿¡æ¯ï¼Œè¯¦ç»†æè¿°ç›¸å…³åˆ—çš„æ•°æ®åˆ†å¸ƒç‰¹å¾ï¼ˆå¦‚ï¼šæ•°æ®å€¾æ–œã€å€¼çš„èŒƒå›´ã€é«˜é¢‘å€¼ç­‰ï¼‰ã€‚
            2. **åˆ†æé¢„æµ‹æ•ˆç‡**ï¼šåˆ†æSQLä¸­WHEREæ¡ä»¶æ¶‰åŠçš„åˆ—ã€‚åœ¨å½“å‰æ•°æ®åˆ†å¸ƒä¸‹ï¼Œå¦‚æœè¯¥SQLæ‰§è¡Œï¼Œå…¶æ•ˆç‡å¦‚ä½•ï¼Ÿç‰¹åˆ«æ˜¯å¦‚æœæ˜¯èŒƒå›´æŸ¥è¯¢ï¼ˆRANGEï¼‰ï¼Œé¢„ä¼°å…¶æ‰«æè¡Œæ•°å’Œç´¢å¼•æ•ˆç‡ã€‚
            3. **è¯†åˆ«ç“¶é¢ˆ**ï¼šæ˜¯å¦å¯èƒ½å‡ºç°å…¨è¡¨æ‰«æï¼Ÿæ•°æ®åˆ†å¸ƒæ˜¯å¦ä¼šå¯¼è‡´ç°æœ‰çš„ç´¢å¼•å¤±æ•ˆï¼Ÿ
            
            ## è¾“å‡ºæ ¼å¼ï¼š
            è¯·ç›´æ¥ç»™å‡ºåˆ†æå†…å®¹ï¼Œä½¿ç”¨Markdownæ ¼å¼ã€‚
            """;
    }

    private String getDefaultSqlAgentPlanEvaluationTemplate() {
        return """
            ä½ æ˜¯ä¸€ä½MySQLæ€§èƒ½è°ƒä¼˜ä¸“å®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹å®ä¾‹åŒ–çš„SQLåŠå…¶å¯¹åº”çš„EXPLAINæ‰§è¡Œè®¡åˆ’ï¼Œåˆ¤å®šæ‰§è¡Œæ•ˆç‡å¹¶è¯„ä¼°æ·»åŠ ç´¢å¼•çš„å¯è¡Œæ€§ã€‚
            
            ## å®ä¾‹åŒ–SQL
            {instantiated_sql}
            
            ## æ‰§è¡Œè®¡åˆ’ (EXPLAIN)
            {execution_plan}
            
            ## ä»»åŠ¡è¦æ±‚ï¼š
            1. **åˆ¤å®šæ‰§è¡Œè®¡åˆ’æ•ˆç‡**ï¼šåˆ†æè®¿é—®ç±»å‹ï¼ˆtypeï¼‰ã€æ‰«æè¡Œæ•°ï¼ˆrowsï¼‰ã€ä½¿ç”¨çš„ç´¢å¼•ï¼ˆkeyï¼‰ç­‰å…³é”®æŒ‡æ ‡ã€‚
            2. **è¯„ä¼°æ€§èƒ½ç“¶é¢ˆ**ï¼šæ˜¯å¦ä½¿ç”¨äº†æ–‡ä»¶æ’åºï¼ˆfilesortï¼‰ã€ä¸´æ—¶è¡¨ï¼ˆtemporaryï¼‰ï¼Ÿæ˜¯å¦ä¸ºå…¨è¡¨æ‰«æï¼Ÿ
            3. **ç´¢å¼•å¯è¡Œæ€§å»ºè®®**ï¼š
               - å¦‚æœå½“å‰æ²¡æœ‰ä½¿ç”¨ç´¢å¼•æˆ–ç´¢å¼•æ•ˆç‡ä½ä¸‹ï¼Œè¯·æ˜ç¡®å»ºè®®åº”è¯¥åœ¨å“ªäº›åˆ—ä¸Šæ·»åŠ ç´¢å¼•ã€‚
               - è€ƒè™‘å¤åˆç´¢å¼•çš„æœ€ä½³é¡ºåºã€‚
               - åˆ†ææ·»åŠ ç´¢å¼•å¯¹å†™å…¥æ€§èƒ½çš„æ½œåœ¨å½±å“ã€‚
            
            ## è¾“å‡ºæ ¼å¼ï¼š
            è¯·æä¾›ä¸“ä¸šçš„åˆ†ææŠ¥å‘Šï¼Œä½¿ç”¨Markdownæ ¼å¼ã€‚åŒ…å«ï¼š[æ ¸å¿ƒç“¶é¢ˆ]ã€[æ‰§è¡Œæ•ˆç‡åˆ¤å®š]ã€[ç´¢å¼•ä¼˜åŒ–å»ºè®®]ã€‚
            """;
    }

    private String getDefaultSqlRiskAssessmentTemplate() {
        return """
            ä½ æ˜¯ä¸€ä½æ‹¥æœ‰20å¹´ç»éªŒçš„èµ„æ·±MySQL DBAä¸“å®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹SQLè¯­å¥ã€è¡¨ç»“æ„ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç´¢å¼•ï¼‰å’Œåˆ—çš„ç›´æ–¹å›¾ç»Ÿè®¡æ•°æ®ï¼Œé¢„æµ‹è¯¥SQLçš„æ‰§è¡Œé£é™©å’Œæ€§èƒ½è¡¨ç°ã€‚
            
            ## SQLè¯­å¥
            {sql}
            
            ## è¡¨ç»“æ„å’Œç´¢å¼•ä¿¡æ¯
            {table_structure}
            
            ## åˆ—ç›´æ–¹å›¾ç»Ÿè®¡æ•°æ®
            {histogram_data}
            
            ## ä»»åŠ¡è¦æ±‚ï¼š
            
            è¯·åŸºäºè¡¨ç»“æ„ï¼ˆåŒ…æ‹¬ç°æœ‰ç´¢å¼•ï¼‰ã€ç›´æ–¹å›¾æ•°æ®åˆ†æå¹¶é¢„æµ‹ä»¥ä¸‹å†…å®¹ï¼š
            
            1. **é£é™©ç­‰çº§è¯„ä¼°**ï¼š
               - **é‡ç‚¹å…³æ³¨è¡¨ä¸­å·²æœ‰çš„ç´¢å¼•**ï¼Œåˆ¤æ–­æŸ¥è¯¢æ˜¯å¦èƒ½æœ‰æ•ˆåˆ©ç”¨è¿™äº›ç´¢å¼•
               - ç»¼åˆè€ƒè™‘æ•°æ®åˆ†å¸ƒã€é¢„æœŸæ‰«æè¡Œæ•°ã€ç´¢å¼•ä½¿ç”¨æƒ…å†µï¼Œè¯„ä¼°é£é™©ç­‰çº§
               - é£é™©ç­‰çº§å¿…é¡»ä¸ºä»¥ä¸‹ä¹‹ä¸€ï¼šLOWï¼ˆä½é£é™©ï¼‰ã€MEDIUMï¼ˆä¸­ç­‰é£é™©ï¼‰ã€HIGHï¼ˆé«˜é£é™©ï¼‰ã€CRITICALï¼ˆä¸¥é‡é£é™©ï¼‰
               - æ‰«æè¡Œæ•° < 100 ä¸”ä½¿ç”¨ç´¢å¼• â†’ LOW
               - æ‰«æè¡Œæ•° 100-1000 ä¸”ä½¿ç”¨ç´¢å¼• â†’ MEDIUM
               - æ‰«æè¡Œæ•° > 1000 æˆ–æœªä½¿ç”¨ç´¢å¼• â†’ HIGH
               - å…¨è¡¨æ‰«æä¸”æ•°æ®é‡å¤§ â†’ CRITICAL
            
            2. **æ€§èƒ½æŒ‡æ ‡é¢„æµ‹**ï¼š
               - **estimatedRowsExamined**: é¢„ä¼°éœ€è¦æ‰«æçš„è¡Œæ•°ï¼ˆåŸºäºè¡¨ç»“æ„ã€ç´¢å¼•ä¿¡æ¯ã€ç›´æ–¹å›¾åˆ†å¸ƒå’ŒWHEREæ¡ä»¶ï¼‰
               - **expectedIndexUsage**: é¢„æœŸæ˜¯å¦ä¼šä½¿ç”¨ç´¢å¼•ï¼ˆtrue/falseï¼Œ**è¯·ä»”ç»†æ£€æŸ¥è¡¨ä¸­å·²æœ‰çš„ç´¢å¼•**ï¼‰
               - **expectedIndexName**: é¢„æœŸä½¿ç”¨çš„ç´¢å¼•åç§°ï¼ˆ**å¿…é¡»ä»è¡¨ç»“æ„ä¸­çš„å®é™…ç´¢å¼•ä¸­é€‰æ‹©ï¼Œå¦‚æœæ²¡æœ‰åˆé€‚çš„ç´¢å¼•åˆ™ä¸ºnull**ï¼‰
               - **expectedAccessType**: é¢„æœŸçš„è®¿é—®ç±»å‹ï¼ˆALL, index, range, ref, eq_ref, constï¼Œ**åŸºäºç´¢å¼•æƒ…å†µåˆ¤æ–­**ï¼‰
               - **estimatedQueryCost**: é¢„ä¼°çš„æŸ¥è¯¢æˆæœ¬ï¼ˆ1-10000ï¼‰
            
            3. **æµ‹è¯•å‚æ•°å»ºè®®**ï¼š
               - åŸºäºç›´æ–¹å›¾æ•°æ®ï¼Œå»ºè®®å…·ä½“çš„æµ‹è¯•å‚æ•°å€¼
               - å‚æ•°åº”è¯¥è¦†ç›–å…¸å‹åœºæ™¯ï¼ˆå¦‚ï¼šæœ€å°å€¼ã€æœ€å¤§å€¼ã€ä¸­ä½æ•°ã€é«˜é¢‘å€¼ï¼‰
               - æ ¼å¼ï¼š{"param_name": "value"} æˆ– {"column_name": "value"}
            
            4. **é¢„æµ‹ç†ç”±**ï¼š
               - **è¯¦ç»†è¯´æ˜ä¸ºä»€ä¹ˆé€‰æ‹©æˆ–ä¸é€‰æ‹©æŸä¸ªç´¢å¼•**
               - åŸºäºè¡¨ç»“æ„ã€ç°æœ‰ç´¢å¼•å’Œç›´æ–¹å›¾çš„æ•°æ®åˆ†å¸ƒç‰¹å¾è¿›è¡Œåˆ†æ
               - è¯´æ˜WHEREæ¡ä»¶å¯¹ç´¢å¼•é€‰æ‹©å’Œæ•°æ®åˆ†å¸ƒçš„å½±å“
               - å¦‚æœæœ‰ç´¢å¼•ä½†é¢„æµ‹ä¸ä¼šä½¿ç”¨ï¼Œå¿…é¡»è¯´æ˜åŸå› 
            
            5. **ä¼˜åŒ–å»ºè®®**ï¼š
               - æä¾›è‡³å°‘3æ¡å…·ä½“çš„ä¼˜åŒ–å»ºè®®
               - æ¯æ¡å»ºè®®åº”è¯¥å¯æ‰§è¡Œä¸”æœ‰é’ˆå¯¹æ€§
               - **å¦‚æœç°æœ‰ç´¢å¼•ä¸åˆé€‚ï¼Œå»ºè®®åˆ›å»ºæ–°çš„ç´¢å¼•æˆ–ä¿®æ”¹ç°æœ‰ç´¢å¼•**
            
            ## è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆJSONæ ¼å¼ï¼‰ï¼š
            
            è¯·ä»¥JSONæ ¼å¼è¾“å‡ºï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹å­—æ®µï¼š
            
            JSONç»“æ„ç¤ºä¾‹ï¼š
            - riskLevel: å­—ç¬¦ä¸²ï¼Œå€¼ä¸º LOW, MEDIUM, HIGH, CRITICAL ä¹‹ä¸€
            - estimatedRowsExamined: æ•°å­—ï¼Œé¢„ä¼°æ‰«æè¡Œæ•°
            - expectedIndexUsage: å¸ƒå°”å€¼ï¼Œtrue æˆ– false
            - expectedIndexName: å­—ç¬¦ä¸²ï¼Œç´¢å¼•åç§°æˆ– null
            - expectedAccessType: å­—ç¬¦ä¸²ï¼ŒALL, index, range, ref, eq_ref, const ä¹‹ä¸€
            - estimatedQueryCost: æ•°å­—ï¼ŒæŸ¥è¯¢æˆæœ¬
            - suggestedParameters: å¯¹è±¡ï¼Œé”®å€¼å¯¹è¡¨ç¤ºå‚æ•°åå’Œå»ºè®®å€¼
            - reasoning: å­—ç¬¦ä¸²ï¼Œè¯¦ç»†çš„é¢„æµ‹ç†ç”±
            - recommendations: æ•°ç»„ï¼ŒåŒ…å«ä¼˜åŒ–å»ºè®®å­—ç¬¦ä¸²
            
            **é‡è¦æç¤º**ï¼š
            - å¿…é¡»è¿”å›æœ‰æ•ˆçš„JSONæ ¼å¼ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡æœ¬
            - æ‰€æœ‰å­—æ®µéƒ½å¿…é¡»å¡«å†™ï¼Œä¸èƒ½çœç•¥
            - riskLevel å¿…é¡»æ˜¯å››ä¸ªå€¼ä¹‹ä¸€ï¼šLOW, MEDIUM, HIGH, CRITICAL
            - expectedAccessType å¿…é¡»æ˜¯æ ‡å‡†çš„MySQLè®¿é—®ç±»å‹
            """;
    }

    private String getDefaultSqlRiskComparisonTemplate() {
        return """
            ä½ æ˜¯ä¸€ä½èµ„æ·±çš„MySQL DBAä¸“å®¶ã€‚è¯·å¯¹æ¯”LLMé¢„æµ‹çš„SQLæ‰§è¡Œæƒ…å†µä¸å®é™…EXPLAINç»“æœï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¿®æ­£é¢„æµ‹ã€‚
            
            ## é¢„æµ‹ç»“æœ
            {prediction}
            
            ## å®é™…EXPLAINç»“æœ
            {actual_explain}
            
            ## ä»»åŠ¡è¦æ±‚ï¼š
            
            è¯·å¯¹æ¯”ä»¥ä¸‹å…³é”®æŒ‡æ ‡ï¼š
            
            1. **æ‰«æè¡Œæ•°å¯¹æ¯”**ï¼š
               - é¢„æµ‹çš„ estimatedRowsExamined vs å®é™…çš„ rows_examined_per_scan
               - å¦‚æœåå·®è¶…è¿‡50%æˆ–åå·®ç»å¯¹å€¼è¶…è¿‡1000è¡Œï¼Œè§†ä¸ºéœ€è¦ä¿®æ­£
            
            2. **ç´¢å¼•ä½¿ç”¨å¯¹æ¯”**ï¼š
               - é¢„æµ‹çš„ expectedIndexUsage vs å®é™…æ˜¯å¦ä½¿ç”¨ç´¢å¼•ï¼ˆkeyå­—æ®µï¼‰
               - å¦‚æœé¢„æµ‹ä½¿ç”¨ç´¢å¼•ä½†å®é™…æœªä½¿ç”¨ï¼Œæˆ–ç›¸åï¼Œè§†ä¸ºéœ€è¦ä¿®æ­£
            
            3. **è®¿é—®ç±»å‹å¯¹æ¯”**ï¼š
               - é¢„æµ‹çš„ expectedAccessType vs å®é™…çš„ access_type
               - å¦‚æœé¢„æµ‹ä¸ºé«˜æ•ˆè®¿é—®ï¼ˆref, eq_ref, constï¼‰ä½†å®é™…ä¸ºä½æ•ˆè®¿é—®ï¼ˆALL, indexï¼‰ï¼Œè§†ä¸ºéœ€è¦ä¿®æ­£
            
            4. **é£é™©ç­‰çº§è¯„ä¼°**ï¼š
               - å¦‚æœå®é™…æ‰«æè¡Œæ•°æ˜¾ç¤ºä¸ºå…¨è¡¨æ‰«æï¼ˆtype=ALLï¼‰ä½†é¢„æµ‹ä¸ºä½é£é™©ï¼Œè§†ä¸ºéœ€è¦ä¿®æ­£
               - å¦‚æœå®é™…ä½¿ç”¨äº†ç´¢å¼•ä½†é¢„æµ‹ä¸ºé«˜é£é™©ï¼Œå¯èƒ½éœ€è¦ä¿®æ­£
            
            ## è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆJSONæ ¼å¼ï¼‰ï¼š
            
            è¯·ä»¥JSONæ ¼å¼è¾“å‡ºåˆ¤æ–­ç»“æœï¼š
            
            JSONç»“æ„è¯´æ˜ï¼š
            - needsRefinement: å¸ƒå°”å€¼ï¼Œtrue è¡¨ç¤ºéœ€è¦ä¿®æ­£ï¼Œfalse è¡¨ç¤ºä¸éœ€è¦
            - deviationSeverity: å­—ç¬¦ä¸²ï¼ŒNONE, MINOR, MODERATE, SEVERE ä¹‹ä¸€
            - deviations: æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ åŒ…å« metricï¼ˆæŒ‡æ ‡åç§°ï¼‰, predictedï¼ˆé¢„æµ‹å€¼ï¼‰, actualï¼ˆå®é™…å€¼ï¼‰, severityï¼ˆä¸¥é‡ç¨‹åº¦ï¼‰
            - reason: å­—ç¬¦ä¸²ï¼Œæ˜¯å¦éœ€è¦ä¿®æ­£çš„ç†ç”±
            
            **é‡è¦æç¤º**ï¼š
            - å¿…é¡»è¿”å›æœ‰æ•ˆçš„JSONæ ¼å¼
            - needsRefinement ä¸º true è¡¨ç¤ºéœ€è¦ä¿®æ­£ï¼Œfalse è¡¨ç¤ºä¸éœ€è¦
            - deviationSeverity å¿…é¡»æ˜¯ï¼šNONE, MINOR, MODERATE, SEVERE ä¹‹ä¸€
            """;
    }

    private String getDefaultSqlRiskRefinementTemplate() {
        return """
            ä½ æ˜¯ä¸€ä½èµ„æ·±çš„MySQL DBAä¸“å®¶ã€‚åŸºäºåŸå§‹é¢„æµ‹å’Œå®é™…EXPLAINç»“æœçš„å·®å¼‚ï¼Œè¯·ä¿®æ­£SQLé£é™©è¯„ä¼°ã€‚
            
            ## åŸå§‹é¢„æµ‹
            {original_prediction}
            
            ## å®é™…EXPLAINç»“æœ
            {actual_explain}
            
            ## åå·®è¯´æ˜
            {deviation_details}
            
            ## åˆ—ç›´æ–¹å›¾ç»Ÿè®¡æ•°æ®ï¼ˆå‚è€ƒï¼‰
            {histogram_data}
            
            ## ä»»åŠ¡è¦æ±‚ï¼š
            
            è¯·åŸºäºå®é™…æ‰§è¡Œè®¡åˆ’ä¿®æ­£é¢„æµ‹ï¼Œé‡ç‚¹å…³æ³¨ï¼š
            
            1. **é£é™©ç­‰çº§ä¿®æ­£**ï¼š
               - æ ¹æ®å®é™…çš„è®¿é—®ç±»å‹å’Œæ‰«æè¡Œæ•°é‡æ–°è¯„ä¼°é£é™©ç­‰çº§
               - å¿…é¡»ä½¿ç”¨ï¼šLOW, MEDIUM, HIGH, CRITICAL ä¹‹ä¸€
            
            2. **æ€§èƒ½æŒ‡æ ‡ä¿®æ­£**ï¼š
               - ä½¿ç”¨å®é™…EXPLAINçš„æ•°æ®æ›´æ–°é¢„æµ‹å€¼
               - estimatedRowsExamined åº”æ¥è¿‘å®é™…çš„ rows_examined_per_scan
               - expectedIndexUsage åº”åŒ¹é…å®é™…æ˜¯å¦ä½¿ç”¨ç´¢å¼•
               - expectedAccessType åº”åŒ¹é…å®é™…çš„ access_type
            
            3. **åŸå› åˆ†æ**ï¼š
               - è§£é‡Šä¸ºä»€ä¹ˆåŸå§‹é¢„æµ‹ä¸å®é™…ç»“æœæœ‰åå·®
               - åˆ†æç›´æ–¹å›¾æ•°æ®ä¸å®é™…æ‰§è¡Œè®¡åˆ’çš„å…³ç³»
               - è¯´æ˜ä¿®æ­£çš„ä¾æ®
            
            4. **ä¼˜åŒ–å»ºè®®æ›´æ–°**ï¼š
               - åŸºäºå®é™…æ‰§è¡Œè®¡åˆ’æä¾›æ›´å‡†ç¡®çš„ä¼˜åŒ–å»ºè®®
               - å»ºè®®åº”è¯¥é’ˆå¯¹å®é™…å‘ç°çš„é—®é¢˜
            
            ## è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»ä¸¥æ ¼éµå®ˆJSONæ ¼å¼ï¼‰ï¼š
            
            JSONç»“æ„è¯´æ˜ï¼š
            - riskLevel: å­—ç¬¦ä¸²ï¼ŒLOW, MEDIUM, HIGH, CRITICAL ä¹‹ä¸€
            - estimatedRowsExamined: æ•°å­—
            - expectedIndexUsage: å¸ƒå°”å€¼
            - expectedIndexName: å­—ç¬¦ä¸²æˆ–null
            - expectedAccessType: å­—ç¬¦ä¸²
            - estimatedQueryCost: æ•°å­—
            - suggestedParameters: å¯¹è±¡ï¼Œå‚æ•°é”®å€¼å¯¹
            - reasoning: å­—ç¬¦ä¸²ï¼Œä¿®æ­£åçš„ç†ç”±ï¼Œè¯´æ˜ä¸ºä»€ä¹ˆä¸åŸå§‹é¢„æµ‹ä¸åŒ
            - recommendations: æ•°ç»„ï¼ŒåŸºäºå®é™…æ‰§è¡Œè®¡åˆ’çš„ä¼˜åŒ–å»ºè®®
            
            **é‡è¦æç¤º**ï¼š
            - å¿…é¡»è¿”å›æœ‰æ•ˆçš„JSONæ ¼å¼
            - æ‰€æœ‰å­—æ®µæ ¼å¼ä¸åŸå§‹é¢„æµ‹ç›¸åŒ
            - reasoning å­—æ®µåº”è¯¥è§£é‡Šä¿®æ­£çš„åŸå› 
            - ä¼˜å…ˆä½¿ç”¨å®é™…EXPLAINçš„æ•°æ®è€Œä¸æ˜¯é¢„æµ‹æ•°æ®
            """;
    }

    private String getDefaultSqlParameterFillingTemplate() {
        return """
            ä½ æ˜¯ä¸€å SQL æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œè€Œä¸æ˜¯è‡ªç”±å‘æŒ¥çš„æ–‡æœ¬åŠ©æ‰‹ã€‚
            ä½ çš„ä»»åŠ¡æ˜¯ï¼šåŸºäº SQL æ¨¡æ¿ã€è¡¨ç»“æ„ï¼ˆå«ç´¢å¼•ï¼‰å’Œåˆ—ç›´æ–¹å›¾æ•°æ®ï¼Œ
            ç”Ÿæˆç”¨äºæ‰§è¡Œè®¡åˆ’ä¸ç´¢å¼•æœ‰æ•ˆæ€§éªŒè¯çš„æµ‹è¯• SQLã€‚

            ## è¾“å…¥

            ### SQL æ¨¡æ¿
            {sql}

            ### è¡¨ç»“æ„ä¸ç´¢å¼•
            {table_structure}

            ### åˆ—ç›´æ–¹å›¾æ•°æ®ï¼ˆJSONï¼‰
            {histogram_data}

            ## ç›´æ–¹å›¾æ•°æ®è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰

            æ¯ä¸ªåˆ—ç›´æ–¹å›¾å¯èƒ½åŒ…å«ï¼š
            - columnName
            - dataType
            - minValue / maxValue
            - nullFraction
            - buckets[]ï¼š
              - lowerBound
              - upperBound
              - rowCount
              - frequencyï¼ˆrowCount / totalRowsï¼‰
              - sampleValuesï¼ˆå¯é€‰ï¼‰

            å‚æ•°é€‰æ‹© **å¿…é¡»ä¼˜å…ˆåŸºäº buckets.frequency**ï¼Œ
            ç¦æ­¢åªä½¿ç”¨ minValue / maxValueã€‚

            ## å ä½ç¬¦è¯†åˆ«è§„åˆ™

            - æ”¯æŒï¼š? 
            - æ ¹æ® WHERE æ¡ä»¶åˆ¤æ–­å ä½ç¬¦å¯¹åº”çš„åˆ—
            - æ— æ³•ç¡®å®šæ—¶ï¼ŒæŒ‰å‡ºç°é¡ºåºæ˜ å°„

            ## åœºæ™¯ç”Ÿæˆè§„åˆ™ï¼ˆå¿…é¡»ç”Ÿæˆ 3â€“5 ä¸ªï¼‰

            ### åœºæ™¯ 1ï¼šæœ€å°å€¼åœºæ™¯ï¼ˆè¾¹ç•Œï¼‰
            - ä½¿ç”¨æœ€å° bucket æˆ– minValue
            - ä¼°ç®—é€‰æ‹©æ€§åº”æä½

            ### åœºæ™¯ 2ï¼šæœ€å¤§å€¼åœºæ™¯ï¼ˆè¾¹ç•Œï¼‰
            - ä½¿ç”¨æœ€å¤§ bucket æˆ– maxValue
            - ä¼°ç®—é€‰æ‹©æ€§åº”æä½

            ### åœºæ™¯ 3ï¼šå…¸å‹å€¼åœºæ™¯ï¼ˆé«˜é¢‘ï¼‰
            - é€‰æ‹© frequency æœ€é«˜çš„ bucket
            - ä½¿ç”¨è¯¥ bucket çš„ä¸­é—´å€¼æˆ– sampleValues
            - ä¼°ç®—é€‰æ‹©æ€§åº”æ¥è¿‘è¯¥ bucket çš„ frequency

            ### åœºæ™¯ 4ï¼šç¨€ç–å€¼åœºæ™¯ï¼ˆé«˜é€‰æ‹©æ€§ï¼Œå¯é€‰ï¼‰
            - é€‰æ‹© frequency æœ€ä½ä½†é 0 çš„ bucket
            - ä¼°ç®—é€‰æ‹©æ€§æé«˜ï¼ˆç´¢å¼•å‹å¥½ï¼‰

            ### åœºæ™¯ 5ï¼šç´¢å¼•å¤±æ•ˆåœºæ™¯ï¼ˆå¿…é¡»å°½é‡ç”Ÿæˆï¼‰
            - æ„é€ è¦†ç›– â‰¥ 70% è¡Œæ•°çš„æ¡ä»¶ï¼š
              - è·¨å¤šä¸ªé«˜é¢‘ bucket çš„èŒƒå›´
              - æˆ–ä½¿ç”¨æä½é€‰æ‹©æ€§çš„ç­‰å€¼æ¡ä»¶
            - é¢„æœŸå¯èƒ½è§¦å‘å…¨è¡¨æ‰«æ

            ## èŒƒå›´æŸ¥è¯¢å‚æ•°è§„åˆ™ï¼ˆå¿…é¡»éµå®ˆï¼‰

            è‹¥æ¡ä»¶åŒ…å« >ã€>=ã€<ã€<=ã€BETWEENï¼š

            - é«˜é¢‘åœºæ™¯ï¼šèŒƒå›´é™åˆ¶åœ¨å•ä¸ªé«˜é¢‘ bucket å†…
            - ç¨€ç–åœºæ™¯ï¼šèŒƒå›´é™åˆ¶åœ¨å•ä¸ªä½é¢‘ bucket å†…
            - ç´¢å¼•å¤±æ•ˆåœºæ™¯ï¼šèŒƒå›´å¿…é¡»è·¨å¤šä¸ª bucket

            ## SQL å¡«å……è§„åˆ™

            - æ•°å€¼ï¼šç›´æ¥å¡«å€¼
            - å­—ç¬¦ä¸²ï¼šå•å¼•å·
            - æ—¥æœŸæ—¶é—´ï¼šä½¿ç”¨ç›´æ–¹å›¾è¾¹ç•Œæ¨ç®—
            - NULLï¼šä½¿ç”¨ NULL
            - filledSql å¿…é¡»æ˜¯å¯ç›´æ¥æ‰§è¡Œçš„ SQL

            ## è¾“å‡ºæ ¼å¼ï¼ˆä¸¥æ ¼ JSONï¼‰

            ä»…è¿”å› JSONï¼Œä¸å¾—åŒ…å«å…¶ä»–æ–‡æœ¬ï¼š

            {
              "originalSql": "...",
              "scenarios": [
                {
                  "scenarioName": "...",
                  "filledSql": "...",
                  "parameters": { "column": value },
                }
              ],
            }

            ## å¼‚å¸¸å¤„ç†

            - æ— ç›´æ–¹å›¾ï¼šä½¿ç”¨åˆç†å‡è®¾å¹¶è¯´æ˜
            - æ— å ä½ç¬¦ï¼šä¿®æ”¹ WHERE æ¡ä»¶ç”Ÿæˆåœºæ™¯
            - ä¿¡æ¯ä¸è¶³ï¼šä¼˜å…ˆç”Ÿæˆå…¸å‹å€¼ + ç´¢å¼•å¤±æ•ˆåœºæ™¯
            """;
    }

    private String getDefaultSqlIndexOptimizationTemplate() {
        return """
                # Role
                ä½ æ˜¯ä¸€ä½æ‹¥æœ‰20å¹´ç»éªŒçš„é¡¶çº§ MySQL æ•°æ®åº“æ€§èƒ½è°ƒä¼˜ä¸“å®¶ã€‚ä½ å½“å‰çš„ä»»åŠ¡æ˜¯æ ¹æ®æä¾›çš„å…ƒæ•°æ®å’Œå¤šåœºæ™¯æ‰§è¡Œè®¡åˆ’ï¼Œä¸ºå¼€å‘å›¢é˜Ÿæä¾›ç²¾å‡†çš„ç´¢å¼•ä¼˜åŒ–æ–¹æ¡ˆã€‚
                            
                # Context 1: åº“è¡¨ç»Ÿè®¡ä¿¡æ¯ (Table & Statistics)
                {table_structures}
                *(æ³¨ï¼šè¯·é‡ç‚¹å…³æ³¨ Table_Rows å’Œ Index Cardinality)*
                            
                # Context 2: å¤šåœºæ™¯æ‰§è¡Œè®¡åˆ’éªŒè¯ç»“æœ (Execution Analysis)
                {analysis_results}
                *(æ³¨ï¼šåŒ…å« NO_INDEX å’Œ PLAN_SHIFT ä¸¤ç±»å…³é”®ç“¶é¢ˆ)*
                            
                # Task Requirements
                è¯·ç»“åˆä»¥ä¸Šæ•°æ®ï¼Œè¿›è¡Œæ·±åº¦çš„ç´¢å¼•å»ºæ¨¡åˆ†æï¼Œå¹¶æŒ‰ Markdown æ ¼å¼è¾“å‡ºæŠ¥å‘Šï¼š
                            
                ### æ ¸å¿ƒè¯Šæ–­é€»è¾‘ï¼š
                1. **é’ˆå¯¹ NO_INDEX (å…¨è¡¨æ‰«æ)**ï¼š
                   - åˆ†æ WHERE å’Œ JOIN æ¡ä»¶ä¸­çš„å­—æ®µã€‚
                   - æ£€æŸ¥ç´¢å¼•åŸºæ•° (Cardinality)ï¼Œä¼˜å…ˆå°†é«˜è¾¨è¯†åº¦å­—æ®µæ”¾åœ¨å¤åˆç´¢å¼•å‰éƒ¨ã€‚
                   - **å…³é”®è¯Šæ–­**ï¼šå¯¹æ¯” rowsExamined ä¸è¡¨æ€»è¡Œæ•° Table_Rowsã€‚å¦‚æœæ¯”ä¾‹è¶…è¿‡ 30%ï¼Œå³ä½¿å‘½ä¸­ç´¢å¼•ï¼Œä¹Ÿè¦è¯Šæ–­ä¸º"ç´¢å¼•é€‰æ‹©æ€§å·®"ã€‚
                   - è€ƒè™‘æ˜¯å¦å¯ä»¥é€šè¿‡"è¦†ç›–ç´¢å¼•"å‡å°‘å›è¡¨ã€‚
                2. **é’ˆå¯¹ PLAN_SHIFT (æ‰§è¡Œè®¡åˆ’åç§»)**ï¼š
                   - è¯†åˆ«å“ªäº›å‚æ•°å¯¼è‡´äº†ä¼˜åŒ–å™¨æ”¾å¼ƒç´¢å¼•ã€‚
                   - åˆ†ææ˜¯å¦å› ä¸ºç°æœ‰ç´¢å¼•çš„å­—æ®µé¡ºåºä¸å½“ï¼Œå¯¼è‡´å…¶åœ¨ç‰¹å®šå‚æ•°ä¸‹æˆæœ¬ (Cost) è¿‡é«˜ã€‚
                   - **å…³é”®è¯Šæ–­**ï¼šå¯¹æ¯”ä¸åŒåœºæ™¯ä¸‹çš„ rowsExamined å’Œ accessTypeï¼Œåˆ†æä¸ºä»€ä¹ˆå‚æ•°å˜åŒ–ä¼šå¯¼è‡´ç´¢å¼•é€‰æ‹©å˜åŒ–ã€‚
                   - è¯„ä¼°æ˜¯å¦éœ€è¦ `USE INDEX` æˆ–ä¼˜åŒ–ç´¢å¼•ç»“æ„æ¥ç¨³å®šæ‰§è¡Œè®¡åˆ’ã€‚
                3. **å†—ä½™æ¸…ç†**ï¼š
                   - æ£€æŸ¥ç°æœ‰ç´¢å¼•ä¸­æ˜¯å¦å­˜åœ¨å‰ç¼€é‡å ï¼ˆä¾‹å¦‚æœ‰ (A,B) å°±ä¸éœ€è¦å•ç‹¬çš„ (A)ï¼‰ã€‚
                4. **è¿‡æ»¤å› å­è®¡ç®—**ï¼š
                   - æ ¹æ® Cardinality å’Œ Table_Rows è®¡ç®—åˆ—çš„è¿‡æ»¤æ•ˆç‡ã€‚
                   - è¯„ä¼°ç´¢å¼•çš„é€‰æ‹©æ€§ï¼Œä¼˜å…ˆä¸ºé«˜é€‰æ‹©æ€§å­—æ®µåˆ›å»ºç´¢å¼•ã€‚
                5. **å¤š SQL ç»¼åˆåˆ†æï¼ˆå¦‚æœåˆ†æç»“æœä¸­åŒ…å«å¤šä¸ª SQLï¼‰**ï¼š
                   - **é‡è¦**ï¼šå¦‚æœåˆ†æç»“æœä¸­åŒ…å«å¤šä¸ª SQLï¼Œéœ€è¦ç»¼åˆè€ƒè™‘æ‰€æœ‰ SQL çš„ç´¢å¼•éœ€æ±‚ã€‚
                   - è¯†åˆ«ä¸åŒ SQL çš„æŸ¥è¯¢æ¨¡å¼ï¼Œæ‰¾å‡ºå…±åŒçš„ç´¢å¼•éœ€æ±‚ã€‚
                   - ä¼˜å…ˆè®¾è®¡èƒ½å¤ŸåŒæ—¶ä¼˜åŒ–å¤šä¸ª SQL çš„å¤åˆç´¢å¼•ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ª SQL å•ç‹¬åˆ›å»ºç´¢å¼•ã€‚
                   - åˆ†æä¸åŒ SQL å¯èƒ½ä½¿ç”¨ä¸åŒç´¢å¼•çš„æƒ…å†µï¼Œç¡®ä¿ç´¢å¼•è®¾è®¡ä¸ä¼šç›¸äº’å†²çªã€‚
                   - åœ¨ç´¢å¼•å»ºè®®ä¸­æ˜ç¡®è¯´æ˜æ¯ä¸ªç´¢å¼•ä¸»è¦ä¼˜åŒ–å“ªäº› SQLï¼ˆé€šè¿‡ mapperId æ ‡è¯†ï¼‰ã€‚
                   - é¿å…ä¸ºå•ä¸ª SQL åˆ›å»ºç´¢å¼•è€Œå½±å“å…¶ä»– SQL çš„æ€§èƒ½ã€‚
                   - å¦‚æœå¤šä¸ª SQL è®¿é—®ç›¸åŒè¡¨ä½†æŸ¥è¯¢æ¡ä»¶ä¸åŒï¼Œéœ€è¦è®¾è®¡èƒ½å¤Ÿè¦†ç›–å¤šä¸ªæŸ¥è¯¢æ¨¡å¼çš„ç´¢å¼•ã€‚
                            
                # Output Format (Markdown)
                è¯·ä½¿ç”¨ Markdown æ ¼å¼è¾“å‡ºæŠ¥å‘Šï¼ŒåŒ…å«ä»¥ä¸‹éƒ¨åˆ†ï¼š
                
                ## ğŸ“Š æŠ¥å‘Šæ‘˜è¦
                - **åˆ†æçš„ SQL æ•°é‡**: [æ•°é‡]
                - **å…³é”®é—®é¢˜**: [ç®€è¿°æœ€ä¸¥é‡çš„æ€§èƒ½ç“¶é¢ˆï¼Œå¦‚ï¼šé«˜é¢‘ SQL çš„å…¨è¡¨æ‰«æ]
                - **é¢„æœŸæ•´ä½“æ”¶ç›Š**: [é¢„ä¼°æ•´ä½“å“åº”æ—¶é—´æå‡ç™¾åˆ†æ¯”]
                
                ## â• æ–°å¢ç´¢å¼•å»ºè®®
                å¯¹äºæ¯ä¸ªå»ºè®®ï¼Œè¯·åŒ…å«ï¼š
                - **è¡¨å**: `table_name`
                - **ç´¢å¼•å**: `idx_table_columns`
                - **ç´¢å¼•åˆ—**: col1, col2
                - **åˆ›å»º SQL**:
                  ```sql
                  CREATE INDEX idx_table_columns ON table_name (col1, col2);
                  ```
                - **åŸå› **: [åŸºäºè¿‡æ»¤å› å­åˆ†æï¼šå­—æ®µ col1 çš„åŸºæ•°ä¸º Xï¼Œé€‰æ‹©æ€§ä¼˜äº col2]
                - **ä¼˜å…ˆçº§**: ğŸ”´ HIGH / ğŸŸ¡ MEDIUM / ğŸŸ¢ LOW
                - **å½±å“çš„ SQL**: mapperId1, mapperId2
                - **ä¼˜åŒ–å½±å“**: [è¯¥ç´¢å¼•å¯åŒæ—¶ä¼˜åŒ–å¤šä¸ª SQLï¼Œé¢„è®¡æå‡æ•´ä½“æŸ¥è¯¢æ€§èƒ½ X%]
                
                ## ğŸ”— ç´¢å¼•åˆå¹¶å»ºè®®
                å¯¹äºæ¯ä¸ªå»ºè®®ï¼Œè¯·åŒ…å«ï¼š
                - **åˆå¹¶æ¥æº**: idx_a, idx_b
                - **ç›®æ ‡ç´¢å¼•**: `idx_a_b`
                - **åˆ›å»º SQL**:
                  ```sql
                  CREATE INDEX idx_a_b ON table_name (col1, col2);
                  ```
                - **åŸå› **: [æ¶ˆé™¤å†—ä½™ï¼ŒåŒæ—¶è¦†ç›–æ›´å¤šæŸ¥è¯¢åœºæ™¯]
                - **ä¼˜å…ˆçº§**: ğŸ”´ HIGH / ğŸŸ¡ MEDIUM / ğŸŸ¢ LOW
                
                ## ğŸ¯ USE INDEX å»ºè®®
                å¯¹äºæ¯ä¸ªå»ºè®®ï¼Œè¯·åŒ…å«ï¼š
                - **Mapper ID**: mapperId
                - **æ¨èç´¢å¼•**: `index_name`
                - **ä¼˜åŒ–å SQL**:
                  ```sql
                  SELECT ... USE INDEX (index_name) ...
                  ```
                - **åŸå› **: [è§£å†³ PLAN_SHIFT é—®é¢˜ï¼Œå¼ºåˆ¶ç¨³å®šæ‰§è¡Œè®¡åˆ’ï¼Œé˜²æ­¢å› æ•°æ®åˆ†å¸ƒæ³¢åŠ¨å¯¼è‡´æ…¢æŸ¥è¯¢]
                
                ## ğŸ—‘ï¸ åˆ é™¤ç´¢å¼•å»ºè®®
                å¯¹äºæ¯ä¸ªå»ºè®®ï¼Œè¯·åŒ…å«ï¼š
                - **ç´¢å¼•å**: `index_name`
                - **åˆ é™¤ SQL**:
                  ```sql
                  DROP INDEX index_name ON table_name;
                  ```
                - **åŸå› **: [è¯¥ç´¢å¼•å·²è¢«æ–°å¤åˆç´¢å¼•è¦†ç›–ï¼Œä¸”åœ¨åˆ†æä¸­æœªè¢«ä»»ä½•åœºæ™¯å‘½ä¸­]
                
                è¯·ç¡®ä¿è¾“å‡ºæ ¼å¼æ¸…æ™°ã€ç»“æ„å®Œæ•´ï¼Œä½¿ç”¨æ ‡å‡†çš„ Markdown è¯­æ³•ã€‚
            """;
    }
}

